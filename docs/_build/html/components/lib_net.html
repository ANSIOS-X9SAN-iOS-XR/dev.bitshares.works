

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Net &mdash; BItShares Developers Portal  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="libraries - app" href="lib_app.html" />
    <link rel="prev" title="Chain - db_xxx.cpp" href="lib_chain_db.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> BItShares Developers Portal
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/architectures.html">Introduction &amp; Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/environments.html">Development Environments</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="components.html">System Components Elements</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="lib_database.html">Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_block.html">Block</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_db.html">db folder - object/index</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_protocols.html">Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_evalustors.html">Evaluators</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_objects.html">Objects and Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_chain_db.html">Chain - db_xxx.cpp</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Net</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#config">config</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-messages">core_messages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#trx-message">trx_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#block-message">block_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#item-ids-inventory-message">item_ids_inventory_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#blockchain-item-ids-inventory-message">blockchain_item_ids_inventory_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fetch-blockchain-item-ids-message">fetch_blockchain_item_ids_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fetch-items-message">fetch_items_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#item-not-available-message">item_not_available_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hello-message">hello_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connection-accepted-message">connection_accepted_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connection-rejected-message">connection_rejected_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#address-request-message">address_request_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#address-info">address_info</a></li>
<li class="toctree-l4"><a class="reference internal" href="#address-message">address_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#closing-connection-message">closing_connection_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#current-time-request-message">current_time_request_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#current-time-reply-message">current_time_reply_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#check-firewall-message">check_firewall_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#check-firewall-reply-message">check_firewall_reply_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-current-connections-request-message">get_current_connections_request_message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#current-connection-data">current_connection_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-current-connections-reply-message">get_current_connections_reply_message</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exceptions">exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#message">message</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#message-header">message_header</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id1">message</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#message-oriented-connection">message_oriented_connection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#message-oriented-connection-delegate">message_oriented_connection_delegate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">message_oriented_connection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#node">node</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#message-propagation-data">message_propagation_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#node-delegate">node_delegate</a></li>
<li class="toctree-l4"><a class="reference internal" href="#peer-status">peer_status</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#simulated-network">simulated_network</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#peer-connection">peer_connection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#firewall-check-state-data">firewall_check_state_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">peer_connection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#peer-database">peer_database</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#potential-peer-last-connection-disposition">potential_peer_last_connection_disposition</a></li>
<li class="toctree-l4"><a class="reference internal" href="#potential-peer-record">potential_peer_record</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">peer_database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#stcp-socket">stcp_socket</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">stcp_socket</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lib_app.html">libraries - app</a></li>
<li class="toctree-l2"><a class="reference internal" href="lib_wallet.html">libraries - wallet</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bts_guide/accounts/bts_account.html">BitShares Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/integration.html">Integration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/interaction.html">Blockchain Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testnets.html">Testnets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/bsip.html">BitShares Improvement Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supports_dev/supports.html">Support and Optimizations</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/api_about.html">1. API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/restrictions.html">2. API Access and Restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/calls.html">3. Available Calls, Object, and IDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/blockchain_api.html">4. Blockchain API(s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/wallet_api.html">5. Wallet API - Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/objects_ids.html">6. Objects and IDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/namespaces.html">7. Graphene - Namespaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bts_guide/tutorials/index.html">Developer Guide (Tutorials)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bts_guide/index_faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references/info_comunities.html">BitShares Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/info_comunities.html#bitshares-blockchain">BitShares Blockchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/info_bbf_events.html">BitShares Blockchain Foundation Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/tech_articles.html">BitShares Developers’ Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/tech_articles.html#articles">Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/githubrepo.html">BitShares Repositories</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BItShares Developers Portal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="components.html">System Components Elements</a> &raquo;</li>
        
      <li>Net</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="net">
<span id="lib-net"></span><h1>Net<a class="headerlink" href="#net" title="Permalink to this headline">¶</a></h1>
<p>(<em>coming soon…</em>)</p>
<ul class="simple">
<li>File directory: (../ibraries/net/xxx.cpp)</li>
<li>File directory: (../ibraries/net/include/graphene/net/xxx.hpp)</li>
</ul>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#config" id="id7">config</a></li>
<li><a class="reference internal" href="#core-messages" id="id8">core_messages</a><ul>
<li><a class="reference internal" href="#trx-message" id="id9">trx_message</a></li>
<li><a class="reference internal" href="#block-message" id="id10">block_message</a></li>
<li><a class="reference internal" href="#item-ids-inventory-message" id="id11">item_ids_inventory_message</a></li>
<li><a class="reference internal" href="#blockchain-item-ids-inventory-message" id="id12">blockchain_item_ids_inventory_message</a></li>
<li><a class="reference internal" href="#fetch-blockchain-item-ids-message" id="id13">fetch_blockchain_item_ids_message</a></li>
<li><a class="reference internal" href="#fetch-items-message" id="id14">fetch_items_message</a></li>
<li><a class="reference internal" href="#item-not-available-message" id="id15">item_not_available_message</a></li>
<li><a class="reference internal" href="#hello-message" id="id16">hello_message</a></li>
<li><a class="reference internal" href="#connection-accepted-message" id="id17">connection_accepted_message</a></li>
<li><a class="reference internal" href="#connection-rejected-message" id="id18">connection_rejected_message</a></li>
<li><a class="reference internal" href="#address-request-message" id="id19">address_request_message</a></li>
<li><a class="reference internal" href="#address-info" id="id20">address_info</a></li>
<li><a class="reference internal" href="#address-message" id="id21">address_message</a></li>
<li><a class="reference internal" href="#closing-connection-message" id="id22">closing_connection_message</a></li>
<li><a class="reference internal" href="#current-time-request-message" id="id23">current_time_request_message</a></li>
<li><a class="reference internal" href="#current-time-reply-message" id="id24">current_time_reply_message</a></li>
<li><a class="reference internal" href="#check-firewall-message" id="id25">check_firewall_message</a></li>
<li><a class="reference internal" href="#check-firewall-reply-message" id="id26">check_firewall_reply_message</a></li>
<li><a class="reference internal" href="#get-current-connections-request-message" id="id27">get_current_connections_request_message</a></li>
<li><a class="reference internal" href="#current-connection-data" id="id28">current_connection_data</a></li>
<li><a class="reference internal" href="#get-current-connections-reply-message" id="id29">get_current_connections_reply_message</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exceptions" id="id30">exceptions</a></li>
<li><a class="reference internal" href="#message" id="id31">message</a><ul>
<li><a class="reference internal" href="#message-header" id="id32">message_header</a></li>
<li><a class="reference internal" href="#id1" id="id33">message</a></li>
</ul>
</li>
<li><a class="reference internal" href="#message-oriented-connection" id="id34">message_oriented_connection</a><ul>
<li><a class="reference internal" href="#message-oriented-connection-delegate" id="id35">message_oriented_connection_delegate</a></li>
<li><a class="reference internal" href="#id2" id="id36">message_oriented_connection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#node" id="id37">node</a><ul>
<li><a class="reference internal" href="#message-propagation-data" id="id38">message_propagation_data</a></li>
<li><a class="reference internal" href="#node-delegate" id="id39">node_delegate</a></li>
<li><a class="reference internal" href="#peer-status" id="id40">peer_status</a></li>
<li><a class="reference internal" href="#id3" id="id41">node</a></li>
<li><a class="reference internal" href="#simulated-network" id="id42">simulated_network</a></li>
</ul>
</li>
<li><a class="reference internal" href="#peer-connection" id="id43">peer_connection</a><ul>
<li><a class="reference internal" href="#firewall-check-state-data" id="id44">firewall_check_state_data</a></li>
<li><a class="reference internal" href="#id4" id="id45">peer_connection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#peer-database" id="id46">peer_database</a><ul>
<li><a class="reference internal" href="#potential-peer-last-connection-disposition" id="id47">potential_peer_last_connection_disposition</a></li>
<li><a class="reference internal" href="#potential-peer-record" id="id48">potential_peer_record</a></li>
<li><a class="reference internal" href="#id5" id="id49">peer_database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stcp-socket" id="id50">stcp_socket</a><ul>
<li><a class="reference internal" href="#id6" id="id51">stcp_socket</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="config">
<h2><a class="toc-backref" href="#id7">config</a><a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#define GRAPHENE_NET_PROTOCOL_VERSION                        106</span>

<span class="cm">/**</span>
<span class="cm"> * Define this to enable debugging code in the p2p network interface.</span>
<span class="cm"> * This is code that would never be executed in normal operation, but is</span>
<span class="cm"> * used for automated testing (creating artificial net splits,</span>
<span class="cm"> * tracking where messages came from and when)</span>
<span class="cm"> */</span>
<span class="cp">#define ENABLE_P2P_DEBUGGING_API                             1</span>

<span class="cm">/**</span>
<span class="cm"> * 2MiB</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_MESSAGE_SIZE                                     1024*1024*2</span>
<span class="cp">#define GRAPHENE_NET_DEFAULT_PEER_CONNECTION_RETRY_TIME      30 </span><span class="c1">// seconds</span>

<span class="cm">/**</span>
<span class="cm"> * AFter trying all peers, how long to wait before we check to</span>
<span class="cm"> * see if there are peers we can try again.</span>
<span class="cm"> */</span>
<span class="cp">#define GRAPHENE_PEER_DATABASE_RETRY_DELAY                   15 </span><span class="c1">// seconds</span>

<span class="cp">#define GRAPHENE_NET_PEER_HANDSHAKE_INACTIVITY_TIMEOUT       5</span>

<span class="cp">#define GRAPHENE_NET_PEER_DISCONNECT_TIMEOUT                 20</span>

<span class="cm">/* uncomment next line to use testnet seed ip and port */</span>
<span class="c1">//#define GRAPHENE_TEST_NETWORK                                1</span>

<span class="cp">#define GRAPHENE_NET_TEST_SEED_IP                            &quot;104.236.44.210&quot; </span><span class="c1">// autogenerated</span>
<span class="cp">#define GRAPHENE_NET_TEST_P2P_PORT                           1700</span>
<span class="cp">#define GRAPHENE_NET_DEFAULT_P2P_PORT                        1776</span>
<span class="cp">#define GRAPHENE_NET_DEFAULT_DESIRED_CONNECTIONS             20</span>
<span class="cp">#define GRAPHENE_NET_DEFAULT_MAX_CONNECTIONS                 200</span>

<span class="cp">#define GRAPHENE_NET_MAXIMUM_QUEUED_MESSAGES_IN_BYTES        (1024 * 1024)</span>

<span class="cm">/**</span>
<span class="cm"> * When we receive a message from the network, we advertise it to</span>
<span class="cm"> * our peers and save a copy in a cache were we will find it if</span>
<span class="cm"> * a peer requests it.  We expire out old items out of the cache</span>
<span class="cm"> * after this number of blocks go by.</span>
<span class="cm"> *</span>
<span class="cm"> * Recently lowered from 30 to match the default expiration time</span>
<span class="cm"> * the web wallet imposes on transactions.</span>
<span class="cm"> */</span>
<span class="cp">#define GRAPHENE_NET_MESSAGE_CACHE_DURATION_IN_BLOCKS        5</span>

<span class="cm">/**</span>
<span class="cm"> * We prevent a peer from offering us a list of blocks which, if we fetched them</span>
<span class="cm"> * all, would result in a blockchain that extended into the future.</span>
<span class="cm"> * This parameter gives us some wiggle room, allowing a peer to give us blocks</span>
<span class="cm"> * that would put our blockchain up to an hour in the future, just in case</span>
<span class="cm"> * our clock is a bit off.</span>
<span class="cm"> */</span>
<span class="cp">#define GRAPHENE_NET_FUTURE_SYNC_BLOCKS_GRACE_PERIOD_SEC     (60 * 60)</span>

<span class="cp">#define GRAPHENE_NET_MAX_INVENTORY_SIZE_IN_MINUTES           2</span>

<span class="cp">#define GRAPHENE_NET_MAX_BLOCKS_PER_PEER_DURING_SYNCING      200</span>

<span class="cm">/**</span>
<span class="cm"> * During normal operation, how many items will be fetched from each</span>
<span class="cm"> * peer at a time.  This will only come into play when the network</span>
<span class="cm"> * is being flooded -- typically transactions will be fetched as soon</span>
<span class="cm"> * as we find out about them, so only one item will be requested</span>
<span class="cm"> * at a time.</span>
<span class="cm"> *</span>
<span class="cm"> * No tests have been done to find the optimal value for this</span>
<span class="cm"> * parameter, so consider increasing or decreasing it if performance</span>
<span class="cm"> * during flooding is lacking.</span>
<span class="cm"> */</span>
<span class="cp">#define GRAPHENE_NET_MAX_ITEMS_PER_PEER_DURING_NORMAL_OPERATION  1</span>

<span class="cm">/**</span>
<span class="cm"> * Instead of fetching all item IDs from a peer, then fetching all blocks</span>
<span class="cm"> * from a peer, we will interleave them.  Fetch at least this many block IDs,</span>
<span class="cm"> * then switch into block-fetching mode until the number of blocks we know about</span>
<span class="cm"> * but haven&#39;t yet fetched drops below this</span>
<span class="cm"> */</span>
<span class="cp">#define GRAPHENE_NET_MIN_BLOCK_IDS_TO_PREFETCH               10000</span>

<span class="cp">#define GRAPHENE_NET_MAX_TRX_PER_SECOND                      1000</span>

<span class="cp">#define GRAPHENE_NET_MAX_NESTED_OBJECTS                      (250)</span>

<span class="cp">#define MAXIMUM_PEERDB_SIZE 1000</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="core-messages">
<h2><a class="toc-backref" href="#id8">core_messages</a><a class="headerlink" href="#core-messages" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">graphene</span><span class="o">::</span><span class="n">chain</span><span class="o">::</span><span class="n">signed_transaction</span><span class="p">;</span>
<span class="k">using</span> <span class="n">graphene</span><span class="o">::</span><span class="n">chain</span><span class="o">::</span><span class="n">block_id_type</span><span class="p">;</span>
<span class="k">using</span> <span class="n">graphene</span><span class="o">::</span><span class="n">chain</span><span class="o">::</span><span class="n">transaction_id_type</span><span class="p">;</span>
<span class="k">using</span> <span class="n">graphene</span><span class="o">::</span><span class="n">chain</span><span class="o">::</span><span class="n">signed_block</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="n">fc</span><span class="o">::</span><span class="n">ecc</span><span class="o">::</span><span class="n">public_key_data</span> <span class="n">node_id_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">fc</span><span class="o">::</span><span class="n">ripemd160</span> <span class="n">item_hash_t</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">item_id</span>
<span class="p">{</span>
    <span class="kt">uint32_t</span>      <span class="n">item_type</span><span class="p">;</span>
    <span class="n">item_hash_t</span>   <span class="n">item_hash</span><span class="p">;</span>

    <span class="n">item_id</span><span class="p">()</span> <span class="p">{}</span>
    <span class="n">item_id</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">type</span><span class="p">,</span> <span class="k">const</span> <span class="n">item_hash_t</span><span class="o">&amp;</span> <span class="n">hash</span><span class="p">)</span> <span class="o">:</span>
      <span class="n">item_type</span><span class="p">(</span><span class="n">type</span><span class="p">),</span>
      <span class="n">item_hash</span><span class="p">(</span><span class="n">hash</span><span class="p">)</span>
    <span class="p">{}</span>
    <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="n">item_type</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">item_type</span> <span class="o">&amp;&amp;</span>
             <span class="n">item_hash</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">item_hash</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">core_message_type_enum</span>
<span class="p">{</span>
  <span class="n">trx_message_type</span>                             <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="n">block_message_type</span>                           <span class="o">=</span> <span class="mi">1001</span><span class="p">,</span>
  <span class="n">core_message_type_first</span>                      <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
  <span class="n">item_ids_inventory_message_type</span>              <span class="o">=</span> <span class="mi">5001</span><span class="p">,</span>
  <span class="n">blockchain_item_ids_inventory_message_type</span>   <span class="o">=</span> <span class="mi">5002</span><span class="p">,</span>
  <span class="n">fetch_blockchain_item_ids_message_type</span>       <span class="o">=</span> <span class="mi">5003</span><span class="p">,</span>
  <span class="n">fetch_items_message_type</span>                     <span class="o">=</span> <span class="mi">5004</span><span class="p">,</span>
  <span class="n">item_not_available_message_type</span>              <span class="o">=</span> <span class="mi">5005</span><span class="p">,</span>
  <span class="n">hello_message_type</span>                           <span class="o">=</span> <span class="mi">5006</span><span class="p">,</span>
  <span class="n">connection_accepted_message_type</span>             <span class="o">=</span> <span class="mi">5007</span><span class="p">,</span>
  <span class="n">connection_rejected_message_type</span>             <span class="o">=</span> <span class="mi">5008</span><span class="p">,</span>
  <span class="n">address_request_message_type</span>                 <span class="o">=</span> <span class="mi">5009</span><span class="p">,</span>
  <span class="n">address_message_type</span>                         <span class="o">=</span> <span class="mi">5010</span><span class="p">,</span>
  <span class="n">closing_connection_message_type</span>              <span class="o">=</span> <span class="mi">5011</span><span class="p">,</span>
  <span class="n">current_time_request_message_type</span>            <span class="o">=</span> <span class="mi">5012</span><span class="p">,</span>
  <span class="n">current_time_reply_message_type</span>              <span class="o">=</span> <span class="mi">5013</span><span class="p">,</span>
  <span class="n">check_firewall_message_type</span>                  <span class="o">=</span> <span class="mi">5014</span><span class="p">,</span>
  <span class="n">check_firewall_reply_message_type</span>            <span class="o">=</span> <span class="mi">5015</span><span class="p">,</span>
  <span class="n">get_current_connections_request_message_type</span> <span class="o">=</span> <span class="mi">5016</span><span class="p">,</span>
  <span class="n">get_current_connections_reply_message_type</span>   <span class="o">=</span> <span class="mi">5017</span><span class="p">,</span>
  <span class="n">core_message_type_last</span>                       <span class="o">=</span> <span class="mi">5099</span>
<span class="p">};</span>

<span class="k">const</span> <span class="kt">uint32_t</span> <span class="n">core_protocol_version</span> <span class="o">=</span> <span class="n">GRAPHENE_NET_PROTOCOL_VERSION</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="trx-message">
<h3><a class="toc-backref" href="#id9">trx_message</a><a class="headerlink" href="#trx-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">trx_message</span>
<span class="p">{</span>
   <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

   <span class="n">signed_transaction</span> <span class="n">trx</span><span class="p">;</span>
   <span class="n">trx_message</span><span class="p">()</span> <span class="p">{}</span>
   <span class="n">trx_message</span><span class="p">(</span><span class="n">signed_transaction</span> <span class="n">transaction</span><span class="p">)</span> <span class="o">:</span>
     <span class="n">trx</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">transaction</span><span class="p">))</span>
   <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="block-message">
<h3><a class="toc-backref" href="#id10">block_message</a><a class="headerlink" href="#block-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">block_message</span>
<span class="p">{</span>
   <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

   <span class="n">block_message</span><span class="p">(){}</span>
   <span class="n">block_message</span><span class="p">(</span><span class="k">const</span> <span class="n">signed_block</span><span class="o">&amp;</span> <span class="n">blk</span> <span class="p">)</span>
   <span class="o">:</span><span class="n">block</span><span class="p">(</span><span class="n">blk</span><span class="p">),</span><span class="n">block_id</span><span class="p">(</span><span class="n">blk</span><span class="p">.</span><span class="n">id</span><span class="p">()){}</span>

   <span class="n">signed_block</span>    <span class="n">block</span><span class="p">;</span>
   <span class="n">block_id_type</span>   <span class="n">block_id</span><span class="p">;</span>

<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="item-ids-inventory-message">
<h3><a class="toc-backref" href="#id11">item_ids_inventory_message</a><a class="headerlink" href="#item-ids-inventory-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">item_ids_inventory_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">item_hashes_available</span><span class="p">;</span>

  <span class="n">item_ids_inventory_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">item_ids_inventory_message</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;&amp;</span> <span class="n">item_hashes_available</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">item_type</span><span class="p">(</span><span class="n">item_type</span><span class="p">),</span>
    <span class="n">item_hashes_available</span><span class="p">(</span><span class="n">item_hashes_available</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="blockchain-item-ids-inventory-message">
<h3><a class="toc-backref" href="#id12">blockchain_item_ids_inventory_message</a><a class="headerlink" href="#blockchain-item-ids-inventory-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">blockchain_item_ids_inventory_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="kt">uint32_t</span> <span class="n">total_remaining_item_count</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">item_hashes_available</span><span class="p">;</span>

  <span class="n">blockchain_item_ids_inventory_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">blockchain_item_ids_inventory_message</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">total_remaining_item_count</span><span class="p">,</span>
                                        <span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">,</span>
                                        <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;&amp;</span> <span class="n">item_hashes_available</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">total_remaining_item_count</span><span class="p">(</span><span class="n">total_remaining_item_count</span><span class="p">),</span>
    <span class="n">item_type</span><span class="p">(</span><span class="n">item_type</span><span class="p">),</span>
    <span class="n">item_hashes_available</span><span class="p">(</span><span class="n">item_hashes_available</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="fetch-blockchain-item-ids-message">
<h3><a class="toc-backref" href="#id13">fetch_blockchain_item_ids_message</a><a class="headerlink" href="#fetch-blockchain-item-ids-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">fetch_blockchain_item_ids_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">blockchain_synopsis</span><span class="p">;</span>

  <span class="n">fetch_blockchain_item_ids_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">fetch_blockchain_item_ids_message</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;&amp;</span> <span class="n">blockchain_synopsis</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">item_type</span><span class="p">(</span><span class="n">item_type</span><span class="p">),</span>
    <span class="n">blockchain_synopsis</span><span class="p">(</span><span class="n">blockchain_synopsis</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="fetch-items-message">
<h3><a class="toc-backref" href="#id14">fetch_items_message</a><a class="headerlink" href="#fetch-items-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">fetch_items_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">items_to_fetch</span><span class="p">;</span>

  <span class="n">fetch_items_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">fetch_items_message</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;&amp;</span> <span class="n">items_to_fetch</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">item_type</span><span class="p">(</span><span class="n">item_type</span><span class="p">),</span>
    <span class="n">items_to_fetch</span><span class="p">(</span><span class="n">items_to_fetch</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="item-not-available-message">
<h3><a class="toc-backref" href="#id15">item_not_available_message</a><a class="headerlink" href="#item-not-available-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">item_not_available_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="n">item_id</span> <span class="n">requested_item</span><span class="p">;</span>

  <span class="n">item_not_available_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">item_not_available_message</span><span class="p">(</span><span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">requested_item</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">requested_item</span><span class="p">(</span><span class="n">requested_item</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="hello-message">
<h3><a class="toc-backref" href="#id16">hello_message</a><a class="headerlink" href="#hello-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">hello_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span>                <span class="n">user_agent</span><span class="p">;</span>
  <span class="kt">uint32_t</span>                   <span class="n">core_protocol_version</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">address</span>            <span class="n">inbound_address</span><span class="p">;</span>
  <span class="kt">uint16_t</span>                   <span class="n">inbound_port</span><span class="p">;</span>
  <span class="kt">uint16_t</span>                   <span class="n">outbound_port</span><span class="p">;</span>
  <span class="n">node_id_t</span>                  <span class="n">node_public_key</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ecc</span><span class="o">::</span><span class="n">compact_signature</span> <span class="n">signed_shared_secret</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">sha256</span>                 <span class="n">chain_id</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span>         <span class="n">user_data</span><span class="p">;</span>

  <span class="n">hello_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">hello_message</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">user_agent</span><span class="p">,</span>
                <span class="kt">uint32_t</span> <span class="n">core_protocol_version</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">address</span><span class="o">&amp;</span> <span class="n">inbound_address</span><span class="p">,</span>
                <span class="kt">uint16_t</span> <span class="n">inbound_port</span><span class="p">,</span>
                <span class="kt">uint16_t</span> <span class="n">outbound_port</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">node_id_t</span><span class="o">&amp;</span> <span class="n">node_public_key</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ecc</span><span class="o">::</span><span class="n">compact_signature</span><span class="o">&amp;</span> <span class="n">signed_shared_secret</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">sha256</span><span class="o">&amp;</span> <span class="n">chain_id_arg</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span><span class="o">&amp;</span> <span class="n">user_data</span> <span class="p">)</span> <span class="o">:</span>
    <span class="n">user_agent</span><span class="p">(</span><span class="n">user_agent</span><span class="p">),</span>
    <span class="n">core_protocol_version</span><span class="p">(</span><span class="n">core_protocol_version</span><span class="p">),</span>
    <span class="n">inbound_address</span><span class="p">(</span><span class="n">inbound_address</span><span class="p">),</span>
    <span class="n">inbound_port</span><span class="p">(</span><span class="n">inbound_port</span><span class="p">),</span>
    <span class="n">outbound_port</span><span class="p">(</span><span class="n">outbound_port</span><span class="p">),</span>
    <span class="n">node_public_key</span><span class="p">(</span><span class="n">node_public_key</span><span class="p">),</span>
    <span class="n">signed_shared_secret</span><span class="p">(</span><span class="n">signed_shared_secret</span><span class="p">),</span>
    <span class="n">chain_id</span><span class="p">(</span><span class="n">chain_id_arg</span><span class="p">),</span>
    <span class="n">user_data</span><span class="p">(</span><span class="n">user_data</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="connection-accepted-message">
<h3><a class="toc-backref" href="#id17">connection_accepted_message</a><a class="headerlink" href="#connection-accepted-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">connection_accepted_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="n">connection_accepted_message</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="k">class</span> <span class="nc">rejection_reason_code</span> <span class="p">{</span> <span class="n">unspecified</span><span class="p">,</span>
                                   <span class="n">different_chain</span><span class="p">,</span>
                                   <span class="n">already_connected</span><span class="p">,</span>
                                   <span class="n">connected_to_self</span><span class="p">,</span>
                                   <span class="n">not_accepting_connections</span><span class="p">,</span>
                                   <span class="n">blocked</span><span class="p">,</span>
                                   <span class="n">invalid_hello_message</span><span class="p">,</span>
                                   <span class="n">client_too_old</span> <span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="connection-rejected-message">
<h3><a class="toc-backref" href="#id18">connection_rejected_message</a><a class="headerlink" href="#connection-rejected-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">connection_rejected_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span>                                   <span class="n">user_agent</span><span class="p">;</span>
  <span class="kt">uint32_t</span>                                      <span class="n">core_protocol_version</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span>                              <span class="n">remote_endpoint</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span>                                   <span class="n">reason_string</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">enum_type</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="n">rejection_reason_code</span><span class="o">&gt;</span> <span class="n">reason_code</span><span class="p">;</span>

  <span class="n">connection_rejected_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">connection_rejected_message</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">user_agent</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">core_protocol_version</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">remote_endpoint</span><span class="p">,</span> <span class="n">rejection_reason_code</span> <span class="n">reason_code</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">reason_string</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">user_agent</span><span class="p">(</span><span class="n">user_agent</span><span class="p">),</span>
    <span class="n">core_protocol_version</span><span class="p">(</span><span class="n">core_protocol_version</span><span class="p">),</span>
    <span class="n">remote_endpoint</span><span class="p">(</span><span class="n">remote_endpoint</span><span class="p">),</span>
    <span class="n">reason_string</span><span class="p">(</span><span class="n">reason_string</span><span class="p">),</span>
    <span class="n">reason_code</span><span class="p">(</span><span class="n">reason_code</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="address-request-message">
<h3><a class="toc-backref" href="#id19">address_request_message</a><a class="headerlink" href="#address-request-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">address_request_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="n">address_request_message</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="k">class</span> <span class="nc">peer_connection_direction</span> <span class="p">{</span> <span class="n">unknown</span><span class="p">,</span> <span class="n">inbound</span><span class="p">,</span> <span class="n">outbound</span> <span class="p">};</span>
<span class="k">enum</span> <span class="k">class</span> <span class="nc">firewalled_state</span> <span class="p">{</span> <span class="n">unknown</span><span class="p">,</span> <span class="n">firewalled</span><span class="p">,</span> <span class="n">not_firewalled</span> <span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="address-info">
<h3><a class="toc-backref" href="#id20">address_info</a><a class="headerlink" href="#address-info" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">address_info</span>
<span class="p">{</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span>          <span class="n">remote_endpoint</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span>        <span class="n">last_seen_time</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">microseconds</span>          <span class="n">latency</span><span class="p">;</span>
  <span class="n">node_id_t</span>                 <span class="n">node_id</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">enum_type</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="n">peer_connection_direction</span><span class="o">&gt;</span> <span class="n">direction</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">enum_type</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="n">firewalled_state</span><span class="o">&gt;</span> <span class="n">firewalled</span><span class="p">;</span>

  <span class="n">address_info</span><span class="p">()</span> <span class="p">{}</span>
  <span class="n">address_info</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">remote_endpoint</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span> <span class="n">last_seen_time</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">microseconds</span> <span class="n">latency</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">node_id_t</span><span class="o">&amp;</span> <span class="n">node_id</span><span class="p">,</span>
               <span class="n">peer_connection_direction</span> <span class="n">direction</span><span class="p">,</span>
               <span class="n">firewalled_state</span> <span class="n">firewalled</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">remote_endpoint</span><span class="p">(</span><span class="n">remote_endpoint</span><span class="p">),</span>
    <span class="n">last_seen_time</span><span class="p">(</span><span class="n">last_seen_time</span><span class="p">),</span>
    <span class="n">latency</span><span class="p">(</span><span class="n">latency</span><span class="p">),</span>
    <span class="n">node_id</span><span class="p">(</span><span class="n">node_id</span><span class="p">),</span>
    <span class="n">direction</span><span class="p">(</span><span class="n">direction</span><span class="p">),</span>
    <span class="n">firewalled</span><span class="p">(</span><span class="n">firewalled</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="address-message">
<h3><a class="toc-backref" href="#id21">address_message</a><a class="headerlink" href="#address-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">address_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">address_info</span><span class="o">&gt;</span> <span class="n">addresses</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="closing-connection-message">
<h3><a class="toc-backref" href="#id22">closing_connection_message</a><a class="headerlink" href="#closing-connection-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">closing_connection_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">string</span>        <span class="n">reason_for_closing</span><span class="p">;</span>
  <span class="kt">bool</span>               <span class="n">closing_due_to_error</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">oexception</span>     <span class="n">error</span><span class="p">;</span>

  <span class="n">closing_connection_message</span><span class="p">()</span> <span class="o">:</span> <span class="n">closing_due_to_error</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">closing_connection_message</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">reason_for_closing</span><span class="p">,</span>
                             <span class="kt">bool</span> <span class="n">closing_due_to_error</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
                             <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">oexception</span><span class="o">&amp;</span> <span class="n">error</span> <span class="o">=</span> <span class="n">fc</span><span class="o">::</span><span class="n">oexception</span><span class="p">())</span> <span class="o">:</span>
    <span class="n">reason_for_closing</span><span class="p">(</span><span class="n">reason_for_closing</span><span class="p">),</span>
    <span class="n">closing_due_to_error</span><span class="p">(</span><span class="n">closing_due_to_error</span><span class="p">),</span>
    <span class="n">error</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="current-time-request-message">
<h3><a class="toc-backref" href="#id23">current_time_request_message</a><a class="headerlink" href="#current-time-request-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">current_time_request_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">request_sent_time</span><span class="p">;</span>

  <span class="n">current_time_request_message</span><span class="p">(){}</span>
  <span class="n">current_time_request_message</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">request_sent_time</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">request_sent_time</span><span class="p">(</span><span class="n">request_sent_time</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="current-time-reply-message">
<h3><a class="toc-backref" href="#id24">current_time_reply_message</a><a class="headerlink" href="#current-time-reply-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">current_time_reply_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">request_sent_time</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">request_received_time</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">reply_transmitted_time</span><span class="p">;</span>

  <span class="n">current_time_reply_message</span><span class="p">(){}</span>
  <span class="n">current_time_reply_message</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">request_sent_time</span><span class="p">,</span>
                             <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">request_received_time</span><span class="p">,</span>
                             <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">reply_transmitted_time</span> <span class="o">=</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span><span class="p">())</span> <span class="o">:</span>
    <span class="n">request_sent_time</span><span class="p">(</span><span class="n">request_sent_time</span><span class="p">),</span>
    <span class="n">request_received_time</span><span class="p">(</span><span class="n">request_received_time</span><span class="p">),</span>
    <span class="n">reply_transmitted_time</span><span class="p">(</span><span class="n">reply_transmitted_time</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="check-firewall-message">
<h3><a class="toc-backref" href="#id25">check_firewall_message</a><a class="headerlink" href="#check-firewall-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">check_firewall_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">node_id_t</span> <span class="n">node_id</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">endpoint_to_check</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="k">class</span> <span class="nc">firewall_check_result</span>
<span class="p">{</span>
  <span class="n">unable_to_check</span><span class="p">,</span>
  <span class="n">unable_to_connect</span><span class="p">,</span>
  <span class="n">connection_successful</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="check-firewall-reply-message">
<h3><a class="toc-backref" href="#id26">check_firewall_reply_message</a><a class="headerlink" href="#check-firewall-reply-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">check_firewall_reply_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>
  <span class="n">node_id_t</span> <span class="n">node_id</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">endpoint_checked</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">enum_type</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="n">firewall_check_result</span><span class="o">&gt;</span> <span class="n">result</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="get-current-connections-request-message">
<h3><a class="toc-backref" href="#id27">get_current_connections_request_message</a><a class="headerlink" href="#get-current-connections-request-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">get_current_connections_request_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="current-connection-data">
<h3><a class="toc-backref" href="#id28">current_connection_data</a><a class="headerlink" href="#current-connection-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">current_connection_data</span>
<span class="p">{</span>
  <span class="kt">uint32_t</span>           <span class="n">connection_duration</span><span class="p">;</span> <span class="c1">// in seconds</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span>   <span class="n">remote_endpoint</span><span class="p">;</span>
  <span class="n">node_id_t</span>          <span class="n">node_id</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">microseconds</span>   <span class="n">clock_offset</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">microseconds</span>   <span class="n">round_trip_delay</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">enum_type</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="n">peer_connection_direction</span><span class="o">&gt;</span> <span class="n">connection_direction</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">enum_type</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span> <span class="n">firewalled_state</span><span class="o">&gt;</span> <span class="n">firewalled</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span> <span class="n">user_data</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="get-current-connections-reply-message">
<h3><a class="toc-backref" href="#id29">get_current_connections_reply_message</a><a class="headerlink" href="#get-current-connections-reply-message" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">get_current_connections_reply_message</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="n">core_message_type_enum</span> <span class="n">type</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">upload_rate_one_minute</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">download_rate_one_minute</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">upload_rate_fifteen_minutes</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">download_rate_fifteen_minutes</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">upload_rate_one_hour</span><span class="p">;</span>
  <span class="kt">uint32_t</span> <span class="n">download_rate_one_hour</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">current_connection_data</span><span class="o">&gt;</span> <span class="n">current_connections</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="exceptions">
<h2><a class="toc-backref" href="#id30">exceptions</a><a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// registered in node.cpp</span>

<span class="n">FC_DECLARE_EXCEPTION</span><span class="p">(</span> <span class="n">net_exception</span><span class="p">,</span> <span class="mi">90000</span><span class="p">,</span> <span class="s">&quot;P2P Networking Exception&quot;</span> <span class="p">);</span>
<span class="n">FC_DECLARE_DERIVED_EXCEPTION</span><span class="p">(</span> <span class="n">send_queue_overflow</span><span class="p">,</span>                   <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">net_exception</span><span class="p">,</span> <span class="mi">90001</span><span class="p">,</span> <span class="s">&quot;send queue for this peer exceeded maximum size&quot;</span> <span class="p">);</span>
<span class="n">FC_DECLARE_DERIVED_EXCEPTION</span><span class="p">(</span> <span class="n">insufficient_relay_fee</span><span class="p">,</span>                <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">net_exception</span><span class="p">,</span> <span class="mi">90002</span><span class="p">,</span> <span class="s">&quot;insufficient relay fee&quot;</span> <span class="p">);</span>
<span class="n">FC_DECLARE_DERIVED_EXCEPTION</span><span class="p">(</span> <span class="n">already_connected_to_requested_peer</span><span class="p">,</span>   <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">net_exception</span><span class="p">,</span> <span class="mi">90003</span><span class="p">,</span> <span class="s">&quot;already connected to requested peer&quot;</span> <span class="p">);</span>
<span class="n">FC_DECLARE_DERIVED_EXCEPTION</span><span class="p">(</span> <span class="n">block_older_than_undo_history</span><span class="p">,</span>         <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">net_exception</span><span class="p">,</span> <span class="mi">90004</span><span class="p">,</span> <span class="s">&quot;block is older than our undo history allows us to process&quot;</span> <span class="p">);</span>
<span class="n">FC_DECLARE_DERIVED_EXCEPTION</span><span class="p">(</span> <span class="n">peer_is_on_an_unreachable_fork</span><span class="p">,</span>        <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">net_exception</span><span class="p">,</span> <span class="mi">90005</span><span class="p">,</span> <span class="s">&quot;peer is on another fork&quot;</span> <span class="p">);</span>
<span class="n">FC_DECLARE_DERIVED_EXCEPTION</span><span class="p">(</span> <span class="n">unlinkable_block_exception</span><span class="p">,</span>            <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">net_exception</span><span class="p">,</span> <span class="mi">90006</span><span class="p">,</span> <span class="s">&quot;unlinkable block&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="message">
<h2><a class="toc-backref" href="#id31">message</a><a class="headerlink" href="#message" title="Permalink to this headline">¶</a></h2>
<div class="section" id="message-header">
<h3><a class="toc-backref" href="#id32">message_header</a><a class="headerlink" href="#message-header" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Defines an 8 byte header that is always present because the minimum encrypted packet size is 8 bytes (blowfish).  The maximum message size is defined in config.hpp. The channel, and message type is also included because almost every channel will have a message type field and we might as well include it in the 8 byte header to save space.</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">message_header</span>
<span class="p">{</span>
   <span class="kt">uint32_t</span>  <span class="n">size</span><span class="p">;</span>   <span class="c1">// number of bytes in message, capped at MAX_MESSAGE_SIZE</span>
   <span class="kt">uint32_t</span>  <span class="n">msg_type</span><span class="p">;</span>  <span class="c1">// every channel gets a 16 bit message type specifier</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">fc</span><span class="o">::</span><span class="n">uint160_t</span> <span class="n">message_hash_type</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id33">message</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Abstracts the process of packing/unpacking a message for a particular channel.</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nl">message</span> <span class="p">:</span> <span class="k">public</span> <span class="n">message_header</span>
<span class="p">{</span>
   <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>

   <span class="n">message</span><span class="p">(){}</span>

   <span class="n">message</span><span class="p">(</span> <span class="n">message</span><span class="o">&amp;&amp;</span> <span class="n">m</span> <span class="p">)</span>
   <span class="o">:</span><span class="n">message_header</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">data</span><span class="p">(</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="p">){}</span>

   <span class="n">message</span><span class="p">(</span> <span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">m</span> <span class="p">)</span>
   <span class="o">:</span><span class="n">message_header</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="n">data</span><span class="p">(</span> <span class="n">m</span><span class="p">.</span><span class="n">data</span> <span class="p">){}</span>

   <span class="cm">/**</span>
<span class="cm">    *  Assumes that T::type specifies the message type</span>
<span class="cm">    */</span>
   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
   <span class="n">message</span><span class="p">(</span> <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">m</span> <span class="p">)</span>
   <span class="p">{</span>
      <span class="n">msg_type</span> <span class="o">=</span> <span class="n">T</span><span class="o">::</span><span class="n">type</span><span class="p">;</span>
      <span class="n">data</span>     <span class="o">=</span> <span class="n">fc</span><span class="o">::</span><span class="n">raw</span><span class="o">::</span><span class="n">pack</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
      <span class="n">size</span>     <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
   <span class="p">}</span>

   <span class="n">fc</span><span class="o">::</span><span class="n">uint160_t</span> <span class="n">id</span><span class="p">()</span><span class="k">const</span>
   <span class="p">{</span>
      <span class="k">return</span> <span class="n">fc</span><span class="o">::</span><span class="n">ripemd160</span><span class="o">::</span><span class="n">hash</span><span class="p">(</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
   <span class="p">}</span>

   <span class="cm">/**</span>
<span class="cm">    *  Automatically checks the type and deserializes T in the</span>
<span class="cm">    *  opposite process from the constructor.</span>
<span class="cm">    */</span>
   <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
   <span class="n">T</span> <span class="n">as</span><span class="p">()</span><span class="k">const</span>
   <span class="p">{</span>
       <span class="k">try</span> <span class="p">{</span>
        <span class="n">FC_ASSERT</span><span class="p">(</span> <span class="n">msg_type</span> <span class="o">==</span> <span class="n">T</span><span class="o">::</span><span class="n">type</span> <span class="p">);</span>
        <span class="n">T</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="p">{</span>
           <span class="n">fc</span><span class="o">::</span><span class="n">datastream</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span> <span class="n">ds</span><span class="p">(</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
           <span class="n">fc</span><span class="o">::</span><span class="n">raw</span><span class="o">::</span><span class="n">unpack</span><span class="p">(</span> <span class="n">ds</span><span class="p">,</span> <span class="n">tmp</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
           <span class="c1">// just to make sure that tmp shouldn&#39;t have any data</span>
           <span class="n">fc</span><span class="o">::</span><span class="n">datastream</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">*&gt;</span> <span class="n">ds</span><span class="p">(</span> <span class="k">nullptr</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
           <span class="n">fc</span><span class="o">::</span><span class="n">raw</span><span class="o">::</span><span class="n">unpack</span><span class="p">(</span> <span class="n">ds</span><span class="p">,</span> <span class="n">tmp</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
       <span class="p">}</span> <span class="n">FC_RETHROW_EXCEPTIONS</span><span class="p">(</span> <span class="n">warn</span><span class="p">,</span>
            <span class="s">&quot;error unpacking network message as a &#39;${type}&#39;  ${x} !=? ${msg_type}&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">::</span><span class="n">get_typename</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">name</span><span class="p">()</span> <span class="p">)</span>
            <span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">::</span><span class="n">type</span><span class="p">)</span>
            <span class="p">(</span><span class="s">&quot;msg_type&quot;</span><span class="p">,</span> <span class="n">msg_type</span><span class="p">)</span>
            <span class="p">);</span>
   <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="message-oriented-connection">
<h2><a class="toc-backref" href="#id34">message_oriented_connection</a><a class="headerlink" href="#message-oriented-connection" title="Permalink to this headline">¶</a></h2>
<div class="section" id="message-oriented-connection-delegate">
<h3><a class="toc-backref" href="#id35">message_oriented_connection_delegate</a><a class="headerlink" href="#message-oriented-connection-delegate" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>receives incoming messages from a message_oriented_connection object</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">message_oriented_connection_delegate</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">on_message</span><span class="p">(</span><span class="n">message_oriented_connection</span><span class="o">*</span> <span class="n">originating_connection</span><span class="p">,</span> <span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">received_message</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_connection_closed</span><span class="p">(</span><span class="n">message_oriented_connection</span><span class="o">*</span> <span class="n">originating_connection</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id36">message_oriented_connection</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>uses a secure socket to create a connection that reads and writes a stream of <code class="docutils literal notranslate"><span class="pre">fc::net::message</span></code> objects</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">message_oriented_connection</span>
<span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
     <span class="n">message_oriented_connection</span><span class="p">(</span><span class="n">message_oriented_connection_delegate</span><span class="o">*</span> <span class="n">delegate</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">);</span>
     <span class="o">~</span><span class="n">message_oriented_connection</span><span class="p">();</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">tcp_socket</span><span class="o">&amp;</span> <span class="n">get_socket</span><span class="p">();</span>

     <span class="kt">void</span> <span class="nf">accept</span><span class="p">();</span>
     <span class="kt">void</span> <span class="nf">bind</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">local_endpoint</span><span class="p">);</span>
     <span class="kt">void</span> <span class="nf">connect_to</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">remote_endpoint</span><span class="p">);</span>

     <span class="kt">void</span> <span class="nf">send_message</span><span class="p">(</span><span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">message_to_send</span><span class="p">);</span>
     <span class="kt">void</span> <span class="nf">close_connection</span><span class="p">();</span>
     <span class="kt">void</span> <span class="nf">destroy_connection</span><span class="p">();</span>

     <span class="kt">uint64_t</span>       <span class="nf">get_total_bytes_sent</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
     <span class="kt">uint64_t</span>       <span class="nf">get_total_bytes_received</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">get_last_message_sent_time</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">get_last_message_received_time</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">get_connection_time</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">sha512</span>     <span class="n">get_shared_secret</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
   <span class="k">private</span><span class="o">:</span>
     <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">detail</span><span class="o">::</span><span class="n">message_oriented_connection_impl</span><span class="o">&gt;</span> <span class="n">my</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">message_oriented_connection</span><span class="o">&gt;</span> <span class="n">message_oriented_connection_ptr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="node">
<h2><a class="toc-backref" href="#id37">node</a><a class="headerlink" href="#node" title="Permalink to this headline">¶</a></h2>
<div class="section" id="message-propagation-data">
<h3><a class="toc-backref" href="#id38">message_propagation_data</a><a class="headerlink" href="#message-propagation-data" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>during network development, we need to track message propagation across the network using a structure like this:</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">message_propagation_data</span>
<span class="p">{</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">received_time</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">validated_time</span><span class="p">;</span>
  <span class="n">node_id_t</span> <span class="n">originating_peer</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="node-delegate">
<h3><a class="toc-backref" href="#id39">node_delegate</a><a class="headerlink" href="#node-delegate" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>used by node reports status to client or fetch data from client</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">node_delegate</span>
<span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
      <span class="k">virtual</span> <span class="o">~</span><span class="n">node_delegate</span><span class="p">(){}</span>

      <span class="cm">/**</span>
<span class="cm">       *  If delegate has the item, the network has no need to fetch it.</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="kt">bool</span> <span class="n">has_item</span><span class="p">(</span> <span class="k">const</span> <span class="n">net</span><span class="o">::</span><span class="n">item_id</span><span class="o">&amp;</span> <span class="n">id</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       *  @brief Called when a new block comes in from the network</span>
<span class="cm">       *</span>
<span class="cm">       *  @param sync_mode true if the message was fetched through the sync process, false during normal operation</span>
<span class="cm">       *  @returns true if this message caused the blockchain to switch forks, false if it did not</span>
<span class="cm">       *</span>
<span class="cm">       *  @throws exception if error validating the item, otherwise the item is</span>
<span class="cm">       *          safe to broadcast on.</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">handle_block</span><span class="p">(</span> <span class="k">const</span> <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">block_message</span><span class="o">&amp;</span> <span class="n">blk_msg</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">sync_mode</span><span class="p">,</span>
                                 <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">uint160_t</span><span class="o">&gt;&amp;</span> <span class="n">contained_transaction_message_ids</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       *  @brief Called when a new transaction comes in from the network</span>
<span class="cm">       *</span>
<span class="cm">       *  @throws exception if error validating the item, otherwise the item is</span>
<span class="cm">       *          safe to broadcast on.</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">handle_transaction</span><span class="p">(</span> <span class="k">const</span> <span class="n">graphene</span><span class="o">::</span><span class="n">net</span><span class="o">::</span><span class="n">trx_message</span><span class="o">&amp;</span> <span class="n">trx_msg</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       *  @brief Called when a new message comes in from the network other than a</span>
<span class="cm">       *         block or a transaction.  Currently there are no other possible</span>
<span class="cm">       *         messages, so this should never be called.</span>
<span class="cm">       *</span>
<span class="cm">       *  @throws exception if error validating the item, otherwise the item is</span>
<span class="cm">       *          safe to broadcast on.</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">handle_message</span><span class="p">(</span> <span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">message_to_process</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       *  Assuming all data elements are ordered in some way, this method should</span>
<span class="cm">       *  return up to limit ids that occur *after* from_id.</span>
<span class="cm">       *  On return, remaining_item_count will be set to the number of items</span>
<span class="cm">       *  in our blockchain after the last item returned in the result,</span>
<span class="cm">       *  or 0 if the result contains the last item in the blockchain</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">get_block_ids</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;&amp;</span> <span class="n">blockchain_synopsis</span><span class="p">,</span>
                                                     <span class="kt">uint32_t</span><span class="o">&amp;</span> <span class="n">remaining_item_count</span><span class="p">,</span>
                                                     <span class="kt">uint32_t</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       *  Given the hash of the requested data, fetch the body.</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="n">message</span> <span class="nf">get_item</span><span class="p">(</span> <span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">id</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">virtual</span> <span class="n">chain_id_type</span> <span class="nf">get_chain_id</span><span class="p">()</span><span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       * Returns a synopsis of the blockchain used for syncing.</span>
<span class="cm">       * This consists of a list of selected item hashes from our current preferred</span>
<span class="cm">       * blockchain, exponentially falling off into the past.  Horrible explanation.</span>
<span class="cm">       *</span>
<span class="cm">       * If the blockchain is empty, it will return the empty list.</span>
<span class="cm">       * If the blockchain has one block, it will return a list containing just that block.</span>
<span class="cm">       * If it contains more than one block:</span>
<span class="cm">       *   the first element in the list will be the hash of the highest numbered block that</span>
<span class="cm">       *       we cannot undo</span>
<span class="cm">       *   the second element will be the hash of an item at the half way point in the undoable</span>
<span class="cm">       *       segment of the blockchain</span>
<span class="cm">       *   the third will be ~3/4 of the way through the undoable segment of the block chain</span>
<span class="cm">       *   the fourth will be at ~7/8...</span>
<span class="cm">       *     &amp;c.</span>
<span class="cm">       *   the last item in the list will be the hash of the most recent block on our preferred chain</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">get_blockchain_synopsis</span><span class="p">(</span><span class="k">const</span> <span class="n">item_hash_t</span><span class="o">&amp;</span> <span class="n">reference_point</span><span class="p">,</span>
                                                               <span class="kt">uint32_t</span> <span class="n">number_of_blocks_after_reference_point</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       *  Call this after the call to handle_message succeeds.</span>
<span class="cm">       *</span>
<span class="cm">       *  @param item_type the type of the item we&#39;re synchronizing, will be the same as item passed to the sync_from() call</span>
<span class="cm">       *  @param item_count the number of items known to the node that haven&#39;t been sent to handle_item() yet.</span>
<span class="cm">       *                    After `item_count` more calls to handle_item(), the node will be in sync</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="kt">void</span>     <span class="nf">sync_status</span><span class="p">(</span> <span class="kt">uint32_t</span> <span class="n">item_type</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">item_count</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       *  Call any time the number of connected peers changes.</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="kt">void</span>     <span class="nf">connection_count_changed</span><span class="p">(</span> <span class="kt">uint32_t</span> <span class="n">c</span> <span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">virtual</span> <span class="kt">uint32_t</span> <span class="nf">get_block_number</span><span class="p">(</span><span class="k">const</span> <span class="n">item_hash_t</span><span class="o">&amp;</span> <span class="n">block_id</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="cm">/**</span>
<span class="cm">       * Returns the time a block was produced (if block_id = 0, returns genesis time).</span>
<span class="cm">       * If we don&#39;t know about the block, returns time_point_sec::min()</span>
<span class="cm">       */</span>
      <span class="k">virtual</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span> <span class="n">get_block_time</span><span class="p">(</span><span class="k">const</span> <span class="n">item_hash_t</span><span class="o">&amp;</span> <span class="n">block_id</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">virtual</span> <span class="n">item_hash_t</span> <span class="nf">get_head_block_id</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">virtual</span> <span class="kt">uint32_t</span> <span class="nf">estimate_last_known_fork_from_git_revision_timestamp</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">unix_timestamp</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">error_encountered</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">message</span><span class="p">,</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">oexception</span><span class="o">&amp;</span> <span class="n">error</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">virtual</span> <span class="kt">uint8_t</span> <span class="nf">get_current_block_interval_in_seconds</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="peer-status">
<h3><a class="toc-backref" href="#id40">peer_status</a><a class="headerlink" href="#peer-status" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Information about connected peers that the client may want to make available to the user.</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">peer_status</span>
<span class="p">{</span>
   <span class="kt">uint32_t</span>         <span class="n">version</span><span class="p">;</span>
   <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">host</span><span class="p">;</span>
   <span class="cm">/** info contains the fields required by bitcoin-rpc&#39;s getpeerinfo call, we will likely</span>
<span class="cm">       extend it with our own fields. */</span>
   <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span> <span class="n">info</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id41">node</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>provides application independent P2P broadcast and data synchronization</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">node</span> <span class="o">:</span> <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&gt;</span>
<span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
     <span class="n">node</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">user_agent</span><span class="p">);</span>
     <span class="o">~</span><span class="n">node</span><span class="p">();</span>

     <span class="kt">void</span> <span class="nf">close</span><span class="p">();</span>

     <span class="kt">void</span>      <span class="nf">set_node_delegate</span><span class="p">(</span> <span class="n">node_delegate</span><span class="o">*</span> <span class="n">del</span> <span class="p">);</span>

     <span class="kt">void</span>      <span class="nf">load_configuration</span><span class="p">(</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">path</span><span class="o">&amp;</span> <span class="n">configuration_directory</span> <span class="p">);</span>

     <span class="k">virtual</span> <span class="kt">void</span>      <span class="nf">listen_to_p2p_network</span><span class="p">();</span>
     <span class="k">virtual</span> <span class="kt">void</span>      <span class="nf">connect_to_p2p_network</span><span class="p">();</span>

     <span class="cm">/**</span>
<span class="cm">      *  Add endpoint to internal level_map database of potential nodes</span>
<span class="cm">      *  to attempt to connect to.  This database is consulted any time</span>
<span class="cm">      *  the number connected peers falls below the target.</span>
<span class="cm">      */</span>
     <span class="kt">void</span>      <span class="nf">add_node</span><span class="p">(</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">ep</span> <span class="p">);</span>

     <span class="cm">/**</span>
<span class="cm">      *  Attempt to connect to the specified endpoint immediately.</span>
<span class="cm">      */</span>
     <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">connect_to_endpoint</span><span class="p">(</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">ep</span> <span class="p">);</span>

     <span class="cm">/**</span>
<span class="cm">      *  Specifies the network interface and port upon which incoming</span>
<span class="cm">      *  connections should be accepted.</span>
<span class="cm">      */</span>
     <span class="kt">void</span>      <span class="nf">listen_on_endpoint</span><span class="p">(</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">ep</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">wait_if_not_available</span> <span class="p">);</span>

     <span class="cm">/**</span>
<span class="cm">      *  Call with true to enable listening for incoming connections</span>
<span class="cm">      */</span>
     <span class="kt">void</span> <span class="nf">accept_incoming_connections</span><span class="p">(</span><span class="kt">bool</span> <span class="n">accept</span><span class="p">);</span>

     <span class="cm">/**</span>
<span class="cm">      *  Specifies the port upon which incoming connections should be accepted.</span>
<span class="cm">      *  @param port the port to listen on</span>
<span class="cm">      *  @param wait_if_not_available if true and the port is not available, enter a</span>
<span class="cm">      *                               sleep and retry loop to wait for it to become</span>
<span class="cm">      *                               available.  If false and the port is not available,</span>
<span class="cm">      *                               just choose a random available port</span>
<span class="cm">      */</span>
     <span class="kt">void</span>      <span class="nf">listen_on_port</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">port</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">wait_if_not_available</span><span class="p">);</span>

     <span class="cm">/**</span>
<span class="cm">      * Returns the endpoint the node is listening on.  This is usually the same</span>
<span class="cm">      * as the value previously passed in to listen_on_endpoint, unless we</span>
<span class="cm">      * were unable to bind to that port.</span>
<span class="cm">      */</span>
     <span class="k">virtual</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">get_actual_listening_endpoint</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

     <span class="cm">/**</span>
<span class="cm">      *  @return a list of peers that are currently connected.</span>
<span class="cm">      */</span>
     <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">peer_status</span><span class="o">&gt;</span> <span class="n">get_connected_peers</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

     <span class="cm">/** return the number of peers we&#39;re actively connected to */</span>
     <span class="k">virtual</span> <span class="kt">uint32_t</span> <span class="nf">get_connection_count</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

     <span class="cm">/**</span>
<span class="cm">      *  Add message to outgoing inventory list, notify peers that</span>
<span class="cm">      *  I have a message ready.</span>
<span class="cm">      */</span>
     <span class="k">virtual</span> <span class="kt">void</span>  <span class="nf">broadcast</span><span class="p">(</span> <span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">item_to_broadcast</span> <span class="p">);</span>
     <span class="k">virtual</span> <span class="kt">void</span>  <span class="nf">broadcast_transaction</span><span class="p">(</span> <span class="k">const</span> <span class="n">signed_transaction</span><span class="o">&amp;</span> <span class="n">trx</span> <span class="p">)</span>
     <span class="p">{</span>
        <span class="n">broadcast</span><span class="p">(</span> <span class="n">trx_message</span><span class="p">(</span><span class="n">trx</span><span class="p">)</span> <span class="p">);</span>
     <span class="p">}</span>

     <span class="cm">/**</span>
<span class="cm">      *  Node starts the process of fetching all items after item_id of the</span>
<span class="cm">      *  given item_type.   During this process messages are not broadcast.</span>
<span class="cm">      */</span>
     <span class="k">virtual</span> <span class="kt">void</span>      <span class="nf">sync_from</span><span class="p">(</span><span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">current_head_block</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;&amp;</span> <span class="n">hard_fork_block_numbers</span><span class="p">);</span>

     <span class="kt">bool</span>      <span class="nf">is_connected</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

     <span class="kt">void</span> <span class="nf">set_advanced_node_parameters</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">);</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span> <span class="n">get_advanced_node_parameters</span><span class="p">();</span>
     <span class="n">message_propagation_data</span> <span class="nf">get_transaction_propagation_data</span><span class="p">(</span><span class="k">const</span> <span class="n">graphene</span><span class="o">::</span><span class="n">chain</span><span class="o">::</span><span class="n">transaction_id_type</span><span class="o">&amp;</span> <span class="n">transaction_id</span><span class="p">);</span>
     <span class="n">message_propagation_data</span> <span class="nf">get_block_propagation_data</span><span class="p">(</span><span class="k">const</span> <span class="n">graphene</span><span class="o">::</span><span class="n">chain</span><span class="o">::</span><span class="n">block_id_type</span><span class="o">&amp;</span> <span class="n">block_id</span><span class="p">);</span>
     <span class="n">node_id_t</span> <span class="nf">get_node_id</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
     <span class="kt">void</span> <span class="nf">set_allowed_peers</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">node_id_t</span><span class="o">&gt;&amp;</span> <span class="n">allowed_peers</span><span class="p">);</span>

     <span class="cm">/**</span>
<span class="cm">      * Instructs the node to forget everything in its peer database, mostly for debugging</span>
<span class="cm">      * problems where nodes are failing to connect to the network</span>
<span class="cm">      */</span>
     <span class="kt">void</span> <span class="nf">clear_peer_database</span><span class="p">();</span>

     <span class="kt">void</span> <span class="nf">set_total_bandwidth_limit</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">upload_bytes_per_second</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">download_bytes_per_second</span><span class="p">);</span>

     <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span> <span class="n">network_get_info</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span> <span class="n">network_get_usage_stats</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

     <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">potential_peer_record</span><span class="o">&gt;</span> <span class="n">get_potential_peers</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

     <span class="kt">void</span> <span class="nf">disable_peer_advertising</span><span class="p">();</span>
     <span class="n">fc</span><span class="o">::</span><span class="n">variant_object</span> <span class="n">get_call_statistics</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
   <span class="k">private</span><span class="o">:</span>
     <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">detail</span><span class="o">::</span><span class="n">node_impl</span><span class="p">,</span> <span class="n">detail</span><span class="o">::</span><span class="n">node_impl_deleter</span><span class="o">&gt;</span> <span class="n">my</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="simulated-network">
<h3><a class="toc-backref" href="#id42">simulated_network</a><a class="headerlink" href="#simulated-network" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">simulated_network</span> <span class="o">:</span> <span class="k">public</span> <span class="n">node</span>
 <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
   <span class="o">~</span><span class="n">simulated_network</span><span class="p">();</span>
   <span class="n">simulated_network</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">user_agent</span><span class="p">)</span> <span class="o">:</span> <span class="n">node</span><span class="p">(</span><span class="n">user_agent</span><span class="p">)</span> <span class="p">{}</span>
   <span class="kt">void</span>      <span class="n">listen_to_p2p_network</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>
   <span class="kt">void</span>      <span class="n">connect_to_p2p_network</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>
   <span class="kt">void</span>      <span class="n">connect_to_endpoint</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">ep</span><span class="p">)</span> <span class="k">override</span> <span class="p">{}</span>

   <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">get_actual_listening_endpoint</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="p">();</span> <span class="p">}</span>

   <span class="kt">void</span>      <span class="n">sync_from</span><span class="p">(</span><span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">current_head_block</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;&amp;</span> <span class="n">hard_fork_block_numbers</span><span class="p">)</span> <span class="k">override</span> <span class="p">{}</span>
   <span class="kt">void</span>      <span class="n">broadcast</span><span class="p">(</span><span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">item_to_broadcast</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
   <span class="kt">void</span>      <span class="nf">add_node_delegate</span><span class="p">(</span><span class="n">node_delegate</span><span class="o">*</span> <span class="n">node_delegate_to_add</span><span class="p">);</span>

   <span class="k">virtual</span> <span class="kt">uint32_t</span> <span class="nf">get_connection_count</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">8</span><span class="p">;</span> <span class="p">}</span>
 <span class="k">private</span><span class="o">:</span>
   <span class="k">struct</span> <span class="n">node_info</span><span class="p">;</span>
   <span class="kt">void</span> <span class="nf">message_sender</span><span class="p">(</span><span class="n">node_info</span><span class="o">*</span> <span class="n">destination_node</span><span class="p">);</span>
   <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">node_info</span><span class="o">*&gt;</span> <span class="n">network_nodes</span><span class="p">;</span>
 <span class="p">};</span>


<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">node</span><span class="o">&gt;</span> <span class="n">node_ptr</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">simulated_network</span><span class="o">&gt;</span> <span class="n">simulated_network_ptr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="peer-connection">
<h2><a class="toc-backref" href="#id43">peer_connection</a><a class="headerlink" href="#peer-connection" title="Permalink to this headline">¶</a></h2>
<div class="section" id="firewall-check-state-data">
<h3><a class="toc-backref" href="#id44">firewall_check_state_data</a><a class="headerlink" href="#firewall-check-state-data" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">firewall_check_state_data</span>
<span class="p">{</span>
  <span class="n">node_id_t</span>        <span class="n">expected_node_id</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">endpoint_to_test</span><span class="p">;</span>

  <span class="c1">// if we&#39;re coordinating a firewall check for another node, these are the helper</span>
  <span class="c1">// nodes we&#39;ve already had do the test (if this structure is still relevant, that</span>
  <span class="c1">// that means they have all had indeterminate results</span>
  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">node_id_t</span><span class="o">&gt;</span> <span class="n">nodes_already_tested</span><span class="p">;</span>

  <span class="c1">// If we&#39;re a just a helper node, this is the node we report back to</span>
  <span class="c1">// when we have a result</span>
  <span class="n">node_id_t</span>        <span class="n">requesting_peer</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id45">peer_connection</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span>        <span class="k">class</span> <span class="nc">peer_connection</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">peer_connection_delegate</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">on_message</span><span class="p">(</span><span class="n">peer_connection</span><span class="o">*</span> <span class="n">originating_peer</span><span class="p">,</span>
                          <span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">received_message</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_connection_closed</span><span class="p">(</span><span class="n">peer_connection</span><span class="o">*</span> <span class="n">originating_peer</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">message</span> <span class="nf">get_message_for_item</span><span class="p">(</span><span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">peer_connection</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">peer_connection</span><span class="o">&gt;</span> <span class="n">peer_connection_ptr</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">peer_connection</span> <span class="o">:</span> <span class="k">public</span> <span class="n">message_oriented_connection_delegate</span><span class="p">,</span>
                        <span class="k">public</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_shared_from_this</span><span class="o">&lt;</span><span class="n">peer_connection</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">enum</span> <span class="k">class</span> <span class="nc">our_connection_state</span>
  <span class="p">{</span>
    <span class="n">disconnected</span><span class="p">,</span>
    <span class="n">just_connected</span><span class="p">,</span> <span class="c1">// if in this state, we have sent a hello_message</span>
    <span class="n">connection_accepted</span><span class="p">,</span> <span class="c1">// remote side has sent us a connection_accepted, we&#39;re operating normally with them</span>
    <span class="n">connection_rejected</span> <span class="c1">// remote side has sent us a connection_rejected, we may be exchanging address with them or may just be waiting for them to close</span>
  <span class="p">};</span>
  <span class="k">enum</span> <span class="k">class</span> <span class="nc">their_connection_state</span>
  <span class="p">{</span>
    <span class="n">disconnected</span><span class="p">,</span>
    <span class="n">just_connected</span><span class="p">,</span> <span class="c1">// we have not yet received a hello_message</span>
    <span class="n">connection_accepted</span><span class="p">,</span> <span class="c1">// we have sent them a connection_accepted</span>
    <span class="n">connection_rejected</span> <span class="c1">// we have sent them a connection_rejected</span>
  <span class="p">};</span>
  <span class="k">enum</span> <span class="k">class</span> <span class="nc">connection_negotiation_status</span>
  <span class="p">{</span>
    <span class="n">disconnected</span><span class="p">,</span>
    <span class="n">connecting</span><span class="p">,</span>
    <span class="n">connected</span><span class="p">,</span>
    <span class="n">accepting</span><span class="p">,</span>
    <span class="n">accepted</span><span class="p">,</span>
    <span class="n">hello_sent</span><span class="p">,</span>
    <span class="n">peer_connection_accepted</span><span class="p">,</span>
    <span class="n">peer_connection_rejected</span><span class="p">,</span>
    <span class="n">negotiation_complete</span><span class="p">,</span>
    <span class="n">closing</span><span class="p">,</span>
    <span class="n">closed</span>
  <span class="p">};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">peer_connection_delegate</span><span class="o">*</span>      <span class="n">_node</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&gt;</span> <span class="n">_remote_endpoint</span><span class="p">;</span>
  <span class="n">message_oriented_connection</span>    <span class="n">_message_connection</span><span class="p">;</span>

  <span class="cm">/* a base class for messages on the queue, to hide the fact that some</span>
<span class="cm">   * messages are complete messages and some are only hashes of messages.</span>
<span class="cm">   */</span>
  <span class="k">struct</span> <span class="n">queued_message</span>
  <span class="p">{</span>
    <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">enqueue_time</span><span class="p">;</span>
    <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">transmission_start_time</span><span class="p">;</span>
    <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">transmission_finish_time</span><span class="p">;</span>

    <span class="n">queued_message</span><span class="p">(</span><span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">enqueue_time</span> <span class="o">=</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span><span class="o">::</span><span class="n">now</span><span class="p">())</span> <span class="o">:</span>
      <span class="n">enqueue_time</span><span class="p">(</span><span class="n">enqueue_time</span><span class="p">)</span>
    <span class="p">{}</span>

    <span class="k">virtual</span> <span class="n">message</span> <span class="n">get_message</span><span class="p">(</span><span class="n">peer_connection_delegate</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="cm">/** returns roughly the number of bytes of memory the message is consuming while</span>
<span class="cm">     * it is sitting on the queue</span>
<span class="cm">     */</span>
    <span class="k">virtual</span> <span class="kt">size_t</span> <span class="nf">get_size_in_queue</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">queued_message</span><span class="p">()</span> <span class="p">{}</span>
  <span class="p">};</span>

  <span class="cm">/* when you queue up a &#39;real_queued_message&#39;, a full copy of the message is</span>
<span class="cm">   * stored on the heap until it is sent</span>
<span class="cm">   */</span>
  <span class="k">struct</span> <span class="nl">real_queued_message</span> <span class="p">:</span> <span class="n">queued_message</span>
  <span class="p">{</span>
    <span class="n">message</span>        <span class="n">message_to_send</span><span class="p">;</span>
    <span class="kt">size_t</span>         <span class="n">message_send_time_field_offset</span><span class="p">;</span>

    <span class="n">real_queued_message</span><span class="p">(</span><span class="n">message</span> <span class="n">message_to_send</span><span class="p">,</span>
                        <span class="kt">size_t</span> <span class="n">message_send_time_field_offset</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span>
      <span class="n">message_to_send</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">message_to_send</span><span class="p">)),</span>
      <span class="n">message_send_time_field_offset</span><span class="p">(</span><span class="n">message_send_time_field_offset</span><span class="p">)</span>
    <span class="p">{}</span>

    <span class="n">message</span> <span class="n">get_message</span><span class="p">(</span><span class="n">peer_connection_delegate</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="nf">get_size_in_queue</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="cm">/* when you queue up a &#39;virtual_queued_message&#39;, we just queue up the hash of the</span>
<span class="cm">   * item we want to send.  When it reaches the top of the queue, we make a callback</span>
<span class="cm">   * to the node to generate the message.</span>
<span class="cm">   */</span>
  <span class="k">struct</span> <span class="nl">virtual_queued_message</span> <span class="p">:</span> <span class="n">queued_message</span>
  <span class="p">{</span>
    <span class="n">item_id</span> <span class="n">item_to_send</span><span class="p">;</span>

    <span class="n">virtual_queued_message</span><span class="p">(</span><span class="n">item_id</span> <span class="n">item_to_send</span><span class="p">)</span> <span class="o">:</span>
      <span class="n">item_to_send</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">item_to_send</span><span class="p">))</span>
    <span class="p">{}</span>

    <span class="n">message</span> <span class="n">get_message</span><span class="p">(</span><span class="n">peer_connection_delegate</span><span class="o">*</span> <span class="n">node</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="nf">get_size_in_queue</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="p">};</span>


  <span class="kt">size_t</span> <span class="n">_total_queued_messages_size</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">queued_message</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">queued_message</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">_queued_messages</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">_send_queued_messages_done</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">connection_initiation_time</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">connection_closed_time</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">connection_terminated_time</span><span class="p">;</span>
  <span class="n">peer_connection_direction</span> <span class="n">direction</span><span class="p">;</span>
  <span class="c1">//connection_state state;</span>
  <span class="n">firewalled_state</span> <span class="n">is_firewalled</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">microseconds</span> <span class="n">clock_offset</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">microseconds</span> <span class="n">round_trip_delay</span><span class="p">;</span>

  <span class="n">our_connection_state</span> <span class="n">our_state</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">they_have_requested_close</span><span class="p">;</span>
  <span class="n">their_connection_state</span> <span class="n">their_state</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">we_have_requested_close</span><span class="p">;</span>

  <span class="n">connection_negotiation_status</span> <span class="n">negotiation_status</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">oexception</span> <span class="n">connection_closed_error</span><span class="p">;</span>

  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">get_connection_time</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_message_connection</span><span class="p">.</span><span class="n">get_connection_time</span><span class="p">();</span> <span class="p">}</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">get_connection_terminated_time</span><span class="p">()</span><span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">connection_terminated_time</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">/// data about the peer node</span>
  <span class="c1">/// @{</span>
  <span class="cm">/** node_public_key from the hello message, zero-initialized before we get the hello */</span>
  <span class="n">node_id_t</span>        <span class="n">node_public_key</span><span class="p">;</span>
  <span class="cm">/** the unique identifier we&#39;ll use to refer to the node with.  zero-initialized before</span>
<span class="cm">   * we receive the hello message, at which time it will be filled with either the &quot;node_id&quot;</span>
<span class="cm">   * from the user_data field of the hello, or if none is present it will be filled with a</span>
<span class="cm">   * copy of node_public_key */</span>
  <span class="n">node_id_t</span>        <span class="n">node_id</span><span class="p">;</span>
  <span class="kt">uint32_t</span>         <span class="n">core_protocol_version</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span>      <span class="n">user_agent</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">graphene_git_revision_sha</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span><span class="o">&gt;</span> <span class="n">graphene_git_revision_unix_timestamp</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">fc_git_revision_sha</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span><span class="o">&gt;</span> <span class="n">fc_git_revision_unix_timestamp</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">uint32_t</span><span class="o">&gt;</span> <span class="n">bitness</span><span class="p">;</span>

  <span class="c1">// for inbound connections, these fields record what the peer sent us in</span>
  <span class="c1">// its hello message.  For outbound, they record what we sent the peer</span>
  <span class="c1">// in our hello message</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">address</span> <span class="n">inbound_address</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">inbound_port</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">outbound_port</span><span class="p">;</span>
  <span class="c1">/// @}</span>

  <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">item_id</span><span class="p">,</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span><span class="o">&gt;</span> <span class="n">item_to_time_map_type</span><span class="p">;</span>

  <span class="c1">/// blockchain synchronization state data</span>
  <span class="c1">/// @{</span>
  <span class="n">boost</span><span class="o">::</span><span class="n">container</span><span class="o">::</span><span class="n">deque</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">ids_of_items_to_get</span><span class="p">;</span> <span class="c1">/// id of items in the blockchain that this peer has told us about</span>
  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">ids_of_items_being_processed</span><span class="p">;</span> <span class="c1">/// list of all items this peer has offered use that we&#39;ve already handed to the client but the client hasn&#39;t finished processing</span>
  <span class="kt">uint32_t</span> <span class="n">number_of_unfetched_item_ids</span><span class="p">;</span> <span class="c1">/// number of items in the blockchain that follow ids_of_items_to_get but the peer hasn&#39;t yet told us their ids</span>
  <span class="kt">bool</span> <span class="n">peer_needs_sync_items_from_us</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">we_need_sync_items_from_peer</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">boost</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">item_ids_requested_from_peer</span><span class="p">;</span> <span class="c1">/// we check this to detect a timed-out request and in busy()</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">last_sync_item_received_time</span><span class="p">;</span> <span class="c1">/// the time we received the last sync item or the time we sent the last batch of sync item requests to this peer</span>
  <span class="n">std</span><span class="o">::</span><span class="n">set</span><span class="o">&lt;</span><span class="n">item_hash_t</span><span class="o">&gt;</span> <span class="n">sync_items_requested_from_peer</span><span class="p">;</span> <span class="c1">/// ids of blocks we&#39;ve requested from this peer during sync.  fetch from another peer if this peer disconnects</span>
  <span class="n">item_hash_t</span> <span class="n">last_block_delegate_has_seen</span><span class="p">;</span> <span class="c1">/// the hash of the last block  this peer has told us about that the peer knows</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span> <span class="n">last_block_time_delegate_has_seen</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">inhibit_fetching_sync_blocks</span><span class="p">;</span>
  <span class="c1">/// @}</span>

  <span class="c1">/// non-synchronization state data</span>
  <span class="c1">/// @{</span>
  <span class="k">struct</span> <span class="n">timestamped_item_id</span>
  <span class="p">{</span>
    <span class="n">item_id</span>            <span class="n">item</span><span class="p">;</span>
    <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span> <span class="n">timestamp</span><span class="p">;</span>
    <span class="n">timestamped_item_id</span><span class="p">(</span><span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">item</span><span class="p">,</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span> <span class="n">timestamp</span><span class="p">)</span> <span class="o">:</span>
      <span class="n">item</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
      <span class="n">timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
    <span class="p">{}</span>
  <span class="p">};</span>
  <span class="k">struct</span> <span class="n">timestamp_index</span><span class="p">{};</span>
  <span class="k">typedef</span> <span class="n">boost</span><span class="o">::</span><span class="n">multi_index_container</span><span class="o">&lt;</span><span class="n">timestamped_item_id</span><span class="p">,</span>
                                       <span class="n">boost</span><span class="o">::</span><span class="n">multi_index</span><span class="o">::</span><span class="n">indexed_by</span><span class="o">&lt;</span><span class="n">boost</span><span class="o">::</span><span class="n">multi_index</span><span class="o">::</span><span class="n">hashed_unique</span><span class="o">&lt;</span><span class="n">boost</span><span class="o">::</span><span class="n">multi_index</span><span class="o">::</span><span class="n">member</span><span class="o">&lt;</span><span class="n">timestamped_item_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">timestamped_item_id</span><span class="o">::</span><span class="n">item</span><span class="o">&gt;</span><span class="p">,</span>
                                       <span class="n">std</span><span class="o">::</span><span class="n">hash</span><span class="o">&lt;</span><span class="n">item_id</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">,</span>
                                       <span class="n">boost</span><span class="o">::</span><span class="n">multi_index</span><span class="o">::</span><span class="n">ordered_non_unique</span><span class="o">&lt;</span><span class="n">boost</span><span class="o">::</span><span class="n">multi_index</span><span class="o">::</span><span class="n">tag</span><span class="o">&lt;</span><span class="n">timestamp_index</span><span class="o">&gt;</span><span class="p">,</span>
                                       <span class="n">boost</span><span class="o">::</span><span class="n">multi_index</span><span class="o">::</span><span class="n">member</span><span class="o">&lt;</span><span class="n">timestamped_item_id</span><span class="p">,</span>
                                                                               <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span><span class="p">,</span>
                                                                               <span class="o">&amp;</span><span class="n">timestamped_item_id</span><span class="o">::</span><span class="n">timestamp</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">timestamped_items_set_type</span><span class="p">;</span>

  <span class="n">timestamped_items_set_type</span> <span class="n">inventory_peer_advertised_to_us</span><span class="p">;</span>
  <span class="n">timestamped_items_set_type</span> <span class="n">inventory_advertised_to_peer</span><span class="p">;</span>

  <span class="n">item_to_time_map_type</span> <span class="n">items_requested_from_peer</span><span class="p">;</span>  <span class="c1">/// items we&#39;ve requested from this peer during normal operation.  fetch from another peer if this peer disconnects</span>
  <span class="c1">/// @}</span>

  <span class="c1">// if they&#39;re flooding us with transactions, we set this to avoid fetching for a few seconds to let the</span>
  <span class="c1">// blockchain catch up</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">transaction_fetching_inhibited_until</span><span class="p">;</span>

  <span class="kt">uint32_t</span> <span class="n">last_known_fork_block_number</span><span class="p">;</span>

  <span class="n">fc</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">accept_or_connect_task_done</span><span class="p">;</span>

  <span class="n">firewall_check_state_data</span> <span class="o">*</span><span class="n">firewall_check_state</span><span class="p">;</span>

    <span class="cp">#ifndef NDEBUG</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">fc</span><span class="o">::</span><span class="kr">thread</span><span class="o">*</span> <span class="n">_thread</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">_send_message_queue_tasks_running</span><span class="p">;</span> <span class="c1">// temporary debugging</span>

    <span class="cp">#endif</span>
  <span class="kt">bool</span> <span class="n">_currently_handling_message</span><span class="p">;</span> <span class="c1">// true while we&#39;re in the middle of handling a message from the remote system</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">peer_connection</span><span class="p">(</span><span class="n">peer_connection_delegate</span><span class="o">*</span> <span class="n">delegate</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">destroy</span><span class="p">();</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="n">peer_connection_ptr</span> <span class="n">make_shared</span><span class="p">(</span><span class="n">peer_connection_delegate</span><span class="o">*</span> <span class="n">delegate</span><span class="p">);</span> <span class="c1">// use this instead of the constructor</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">peer_connection</span><span class="p">();</span>

  <span class="n">fc</span><span class="o">::</span><span class="n">tcp_socket</span><span class="o">&amp;</span> <span class="n">get_socket</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">accept_connection</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">connect_to</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">remote_endpoint</span><span class="p">,</span> <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&gt;</span> <span class="n">local_endpoint</span> <span class="o">=</span> <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&gt;</span><span class="p">());</span>

  <span class="kt">void</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">message_oriented_connection</span><span class="o">*</span> <span class="n">originating_connection</span><span class="p">,</span> <span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">received_message</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">on_connection_closed</span><span class="p">(</span><span class="n">message_oriented_connection</span><span class="o">*</span> <span class="n">originating_connection</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

  <span class="kt">void</span> <span class="nf">send_queueable_message</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">queued_message</span><span class="o">&gt;&amp;&amp;</span> <span class="n">message_to_send</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">send_message</span><span class="p">(</span><span class="k">const</span> <span class="n">message</span><span class="o">&amp;</span> <span class="n">message_to_send</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">message_send_time_field_offset</span> <span class="o">=</span> <span class="p">(</span><span class="kt">size_t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">send_item</span><span class="p">(</span><span class="k">const</span> <span class="n">item_id</span><span class="o">&amp;</span> <span class="n">item_to_send</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">close_connection</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">destroy_connection</span><span class="p">();</span>

  <span class="kt">uint64_t</span> <span class="nf">get_total_bytes_sent</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">uint64_t</span> <span class="nf">get_total_bytes_received</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">get_last_message_sent_time</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point</span> <span class="n">get_last_message_received_time</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&gt;</span> <span class="n">get_remote_endpoint</span><span class="p">();</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">get_local_endpoint</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">set_remote_endpoint</span><span class="p">(</span><span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&gt;</span> <span class="n">new_remote_endpoint</span><span class="p">);</span>

  <span class="kt">bool</span> <span class="nf">busy</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="nf">idle</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="nf">is_currently_handling_message</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

  <span class="kt">bool</span> <span class="nf">is_transaction_fetching_inhibited</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">sha512</span> <span class="n">get_shared_secret</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">clear_old_inventory</span><span class="p">();</span>
  <span class="kt">bool</span> <span class="nf">is_inventory_advertised_to_us_list_full_for_transactions</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="nf">is_inventory_advertised_to_us_list_full</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="nf">performing_firewall_check</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&gt;</span> <span class="n">get_endpoint_for_connecting</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">send_queued_messages_task</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">accept_connection_task</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">connect_to_task</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">remote_endpoint</span><span class="p">);</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">peer_connection</span><span class="o">&gt;</span> <span class="n">peer_connection_ptr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="peer-database">
<h2><a class="toc-backref" href="#id46">peer_database</a><a class="headerlink" href="#peer-database" title="Permalink to this headline">¶</a></h2>
<div class="section" id="potential-peer-last-connection-disposition">
<h3><a class="toc-backref" href="#id47">potential_peer_last_connection_disposition</a><a class="headerlink" href="#potential-peer-last-connection-disposition" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">enum</span> <span class="n">potential_peer_last_connection_disposition</span>
<span class="p">{</span>
  <span class="n">never_attempted_to_connect</span><span class="p">,</span>
  <span class="n">last_connection_failed</span><span class="p">,</span>
  <span class="n">last_connection_rejected</span><span class="p">,</span>
  <span class="n">last_connection_handshaking_failed</span><span class="p">,</span>
  <span class="n">last_connection_succeeded</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="potential-peer-record">
<h3><a class="toc-backref" href="#id48">potential_peer_record</a><a class="headerlink" href="#potential-peer-record" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">potential_peer_record</span>
<span class="p">{</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span>                  <span class="n">endpoint</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span>                <span class="n">last_seen_time</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">enum_type</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="p">,</span><span class="n">potential_peer_last_connection_disposition</span><span class="o">&gt;</span> <span class="n">last_connection_disposition</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span>                <span class="n">last_connection_attempt_time</span><span class="p">;</span>
  <span class="kt">uint32_t</span>                          <span class="n">number_of_successful_connection_attempts</span><span class="p">;</span>
  <span class="kt">uint32_t</span>                          <span class="n">number_of_failed_connection_attempts</span><span class="p">;</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">fc</span><span class="o">::</span><span class="n">exception</span><span class="o">&gt;</span>       <span class="n">last_error</span><span class="p">;</span>

  <span class="n">potential_peer_record</span><span class="p">()</span> <span class="o">:</span>
    <span class="n">number_of_successful_connection_attempts</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">number_of_failed_connection_attempts</span><span class="p">(</span><span class="mi">0</span><span class="p">){}</span>

  <span class="n">potential_peer_record</span><span class="p">(</span><span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span> <span class="n">endpoint</span><span class="p">,</span>
                        <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span> <span class="n">last_seen_time</span> <span class="o">=</span> <span class="n">fc</span><span class="o">::</span><span class="n">time_point_sec</span><span class="p">(),</span>
                        <span class="n">potential_peer_last_connection_disposition</span> <span class="n">last_connection_disposition</span> <span class="o">=</span> <span class="n">never_attempted_to_connect</span><span class="p">)</span> <span class="o">:</span>
    <span class="n">endpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">),</span>
    <span class="n">last_seen_time</span><span class="p">(</span><span class="n">last_seen_time</span><span class="p">),</span>
    <span class="n">last_connection_disposition</span><span class="p">(</span><span class="n">last_connection_disposition</span><span class="p">),</span>
    <span class="n">number_of_successful_connection_attempts</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">number_of_failed_connection_attempts</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  <span class="p">{}</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="n">detail</span>
<span class="p">{</span>
  <span class="k">class</span> <span class="nc">peer_database_impl</span><span class="p">;</span>

  <span class="k">class</span> <span class="nc">peer_database_iterator_impl</span><span class="p">;</span>
  <span class="k">class</span> <span class="nc">peer_database_iterator</span> <span class="o">:</span> <span class="k">public</span> <span class="n">boost</span><span class="o">::</span><span class="n">iterator_facade</span><span class="o">&lt;</span><span class="n">peer_database_iterator</span><span class="p">,</span> <span class="k">const</span> <span class="n">potential_peer_record</span><span class="p">,</span> <span class="n">boost</span><span class="o">::</span><span class="n">forward_traversal_tag</span><span class="o">&gt;</span>
  <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="n">peer_database_iterator</span><span class="p">();</span>
    <span class="o">~</span><span class="n">peer_database_iterator</span><span class="p">();</span>
    <span class="k">explicit</span> <span class="nf">peer_database_iterator</span><span class="p">(</span><span class="n">peer_database_iterator_impl</span><span class="o">*</span> <span class="n">impl</span><span class="p">);</span>
    <span class="n">peer_database_iterator</span><span class="p">(</span> <span class="k">const</span> <span class="n">peer_database_iterator</span><span class="o">&amp;</span> <span class="n">c</span> <span class="p">);</span>

  <span class="k">private</span><span class="o">:</span>
    <span class="k">friend</span> <span class="k">class</span> <span class="nc">boost</span><span class="o">::</span><span class="n">iterator_core_access</span><span class="p">;</span>
    <span class="kt">void</span> <span class="nf">increment</span><span class="p">();</span>
    <span class="kt">bool</span> <span class="nf">equal</span><span class="p">(</span><span class="k">const</span> <span class="n">peer_database_iterator</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">potential_peer_record</span><span class="o">&amp;</span> <span class="n">dereference</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">peer_database_iterator_impl</span><span class="o">&gt;</span> <span class="n">my</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id49">peer_database</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">peer_database</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">peer_database</span><span class="p">();</span>
  <span class="o">~</span><span class="n">peer_database</span><span class="p">();</span>

  <span class="kt">void</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">path</span><span class="o">&amp;</span> <span class="n">databaseFilename</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">close</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">clear</span><span class="p">();</span>

  <span class="kt">void</span> <span class="nf">erase</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">endpointToErase</span><span class="p">);</span>

  <span class="kt">void</span> <span class="nf">update_entry</span><span class="p">(</span><span class="k">const</span> <span class="n">potential_peer_record</span><span class="o">&amp;</span> <span class="n">updatedRecord</span><span class="p">);</span>
  <span class="n">potential_peer_record</span> <span class="nf">lookup_or_create_entry_for_endpoint</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">endpointToLookup</span><span class="p">);</span>
  <span class="n">fc</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">potential_peer_record</span><span class="o">&gt;</span> <span class="n">lookup_entry_for_endpoint</span><span class="p">(</span><span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">endpointToLookup</span><span class="p">);</span>

  <span class="k">typedef</span> <span class="n">detail</span><span class="o">::</span><span class="n">peer_database_iterator</span> <span class="n">iterator</span><span class="p">;</span>
  <span class="n">iterator</span> <span class="nf">begin</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">iterator</span> <span class="nf">end</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">detail</span><span class="o">::</span><span class="n">peer_database_impl</span><span class="o">&gt;</span> <span class="n">my</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="stcp-socket">
<h2><a class="toc-backref" href="#id50">stcp_socket</a><a class="headerlink" href="#stcp-socket" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Uses ECDH to negotiate a aes key for communicating with other nodes on the network.</li>
</ul>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id51">stcp_socket</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">stcp_socket</span> <span class="o">:</span> <span class="k">public</span> <span class="k">virtual</span> <span class="n">fc</span><span class="o">::</span><span class="n">iostream</span>
<span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
        <span class="n">stcp_socket</span><span class="p">();</span>
        <span class="o">~</span><span class="n">stcp_socket</span><span class="p">();</span>
        <span class="n">fc</span><span class="o">::</span><span class="n">tcp_socket</span><span class="o">&amp;</span>  <span class="n">get_socket</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_sock</span><span class="p">;</span> <span class="p">}</span>
        <span class="kt">void</span>             <span class="n">accept</span><span class="p">();</span>

        <span class="kt">void</span>             <span class="nf">connect_to</span><span class="p">(</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">remote_endpoint</span> <span class="p">);</span>
        <span class="kt">void</span>             <span class="nf">bind</span><span class="p">(</span> <span class="k">const</span> <span class="n">fc</span><span class="o">::</span><span class="n">ip</span><span class="o">::</span><span class="n">endpoint</span><span class="o">&amp;</span> <span class="n">local_endpoint</span> <span class="p">);</span>

        <span class="k">virtual</span> <span class="kt">size_t</span>   <span class="nf">readsome</span><span class="p">(</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">max</span> <span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">size_t</span>   <span class="nf">readsome</span><span class="p">(</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;&amp;</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">offset</span> <span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">bool</span>     <span class="nf">eof</span><span class="p">()</span><span class="k">const</span><span class="p">;</span>

        <span class="k">virtual</span> <span class="kt">size_t</span>   <span class="nf">writesome</span><span class="p">(</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span> <span class="p">);</span>
        <span class="k">virtual</span> <span class="kt">size_t</span>   <span class="nf">writesome</span><span class="p">(</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span><span class="o">&gt;&amp;</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">offset</span> <span class="p">);</span>

        <span class="k">virtual</span> <span class="kt">void</span>     <span class="nf">flush</span><span class="p">();</span>
        <span class="k">virtual</span> <span class="kt">void</span>     <span class="nf">close</span><span class="p">();</span>

        <span class="k">using</span> <span class="n">istream</span><span class="o">::</span><span class="n">get</span><span class="p">;</span>
        <span class="kt">void</span>             <span class="nf">get</span><span class="p">(</span> <span class="kt">char</span><span class="o">&amp;</span> <span class="n">c</span> <span class="p">)</span> <span class="p">{</span> <span class="n">read</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span> <span class="p">}</span>
        <span class="n">fc</span><span class="o">::</span><span class="n">sha512</span>       <span class="n">get_shared_secret</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_shared_secret</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">private</span><span class="o">:</span>
        <span class="kt">void</span> <span class="n">do_key_exchange</span><span class="p">();</span>

        <span class="n">fc</span><span class="o">::</span><span class="n">sha512</span>           <span class="n">_shared_secret</span><span class="p">;</span>
        <span class="n">fc</span><span class="o">::</span><span class="n">ecc</span><span class="o">::</span><span class="n">private_key</span> <span class="n">_priv_key</span><span class="p">;</span>
        <span class="n">fc</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">,</span><span class="mi">8</span><span class="o">&gt;</span>    <span class="n">_buf</span><span class="p">;</span>
        <span class="c1">//uint32_t             _buf_len;</span>
        <span class="n">fc</span><span class="o">::</span><span class="n">tcp_socket</span>       <span class="n">_sock</span><span class="p">;</span>
        <span class="n">fc</span><span class="o">::</span><span class="n">aes_encoder</span>      <span class="n">_send_aes</span><span class="p">;</span>
        <span class="n">fc</span><span class="o">::</span><span class="n">aes_decoder</span>      <span class="n">_recv_aes</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">_read_buffer</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">_write_buffer</span><span class="p">;</span>
<span class="cp">#ifndef NDEBUG</span>
        <span class="kt">bool</span> <span class="n">_read_buffer_in_use</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">_write_buffer_in_use</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">stcp_socket</span><span class="o">&gt;</span> <span class="n">stcp_socket_ptr</span><span class="p">;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lib_app.html" class="btn btn-neutral float-right" title="libraries - app" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lib_chain_db.html" class="btn btn-neutral" title="Chain - db_xxx.cpp" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright BitShares Blockchain Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>