

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Merchants &mdash; BItShares Developers Portal  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Traders" href="uc_traders.html" />
    <link rel="prev" title="Exchanges, Bridges, and Gateways" href="uc_exchange_integration.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> BItShares Developers Portal
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro/architectures.html">Introduction &amp; Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/environments.html">Development Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../components/components.html">System Components Elements</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bts_guide/accounts/bts_account.html">BitShares Accounts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../integration.html">Integration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../integration.html#basic-knowledge">Basic Knowledge</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../integration.html#use-cases">Use Cases</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="uc_exchange_integration.html">Exchanges, Bridges, and Gateways</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Merchants</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wallet-login-protocol">Wallet Login Protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wallet-merchant-protocol">Wallet Merchant Protocol</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="uc_traders.html">Traders</a></li>
<li class="toctree-l3"><a class="reference internal" href="supporting_features.html">Supporting Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="uc_using_whitelist.html">Using Whitelists and Blacklists</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interaction.html">Blockchain Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testnets.html">Testnets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bsip.html">BitShares Improvement Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../supports_dev/supports.html">Support and Optimizations</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/api_about.html">1. API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/restrictions.html">2. API Access and Restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/calls.html">3. Available Calls, Object, and IDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/blockchain_api.html">4. Blockchain API(s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/wallet_api.html">5. Wallet API - Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/objects_ids.html">6. Objects and IDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/namespaces.html">7. Graphene - Namespaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../bts_guide/tutorials/index.html">Developer Guide (Tutorials)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bts_guide/index_faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../references/info_comunities.html">BitShares Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references/info_comunities.html#bitshares-blockchain">BitShares Blockchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references/tech_articles.html">BitShares Developers’ Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references/tech_articles.html#articles">Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references/githubrepo.html">BitShares Repositories</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BItShares Developers Portal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../integration.html">Integration Guide</a> &raquo;</li>
        
      <li>Merchants</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="merchants">
<span id="usecase-merchants"></span><h1>Merchants<a class="headerlink" href="#merchants" title="Permalink to this headline">¶</a></h1>
<p><strong>Merchants</strong> make use of the currency-denomintated assets of a Graphene network
(e.g. BitShares). Similar to traditional payment solutions they let their
customers pay using bitUSD, bitEUR, or any other <em>stable</em> blockchain asset.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#wallet-login-protocol" id="id3">Wallet Login Protocol</a><ul>
<li><a class="reference internal" href="#step-1-merchant-login-button" id="id4">Step 1 - Merchant Login Button</a></li>
<li><a class="reference internal" href="#step-2-compress-your-json-representation" id="id5">Step 2 - Compress your JSON representation</a></li>
<li><a class="reference internal" href="#step-3-convert-to-base58" id="id6">Step 3 - Convert to Base58</a></li>
<li><a class="reference internal" href="#step-4-wallet-confirmation" id="id7">Step 4 - Wallet Confirmation</a></li>
<li><a class="reference internal" href="#step-5-server-verifies-authority" id="id8">Step 5 - Server Verifies Authority</a></li>
</ul>
</li>
<li><a class="reference internal" href="#wallet-merchant-protocol" id="id9">Wallet Merchant Protocol</a><ul>
<li><a class="reference internal" href="#step-1-define-your-invoice-via-json" id="id10">Step 1: Define your Invoice via JSON</a></li>
<li><a class="reference internal" href="#id1" id="id11">Step 2: Compress your JSON representation</a></li>
<li><a class="reference internal" href="#id2" id="id12">Step 3: Convert to Base58</a></li>
<li><a class="reference internal" href="#step-4-pass-to-wallet" id="id13">Step 4: Pass to Wallet</a></li>
<li><a class="reference internal" href="#step-5-receive-callback-from-wallet" id="id14">Step 5: Receive Callback from Wallet</a></li>
<li><a class="reference internal" href="#step-6-payment-complete" id="id15">Step 6: Payment Complete</a></li>
<li><a class="reference internal" href="#example-python-script" id="id16">Example Python script</a></li>
</ul>
</li>
</ul>
</div>
<p>We here illustrate the steps necessary to securely operate as merchant.
Merchants take funds from customers on the blockchain and deliver a good. Hence,
a merchant should monitor the blockchain and be notified on incoming
transactions. Thanks to (encrypted) transaction memos attachable to each
transfer the merchant can easily distinguish different customers.</p>
<p>For exchanges we recommend to also read <span class="xref std std-ref">what-is-different</span> and
<a class="reference internal" href="../../api/often-used-calls.html#often-used-calls"><span class="std std-ref">Often used API Calls</span></a>.</p>
<hr class="docutils" />
<p>Protocols/API</p>
<div class="section" id="wallet-login-protocol">
<span id="merchants-case-wallet-login-protocol"></span><h2><a class="toc-backref" href="#id3">Wallet Login Protocol</a><a class="headerlink" href="#wallet-login-protocol" title="Permalink to this headline">¶</a></h2>
<p>The idea behind the login protocol is to allow another party to verify that you
are are the owner of a particular account. Traditionally login is performed via
a password that sent to the server, but this method is subject to <a class="reference external" href="https://en.wikipedia.org/wiki/Phishing">Phishing
Attacks</a>. Instead of a password,
Graphene uses a cryptographic challenge/response to verify that a user controls
a particular account.</p>
<p>For the purpose of this document, we will assume <a class="reference external" href="https://merchant.org">https://merchant.org</a> is the
service that will be logged into and that <a class="reference external" href="https://wallet.org">https://wallet.org</a> is the wallet
provider that will be assisting the user with their login.</p>
<div class="section" id="step-1-merchant-login-button">
<h3><a class="toc-backref" href="#id4">Step 1 - Merchant Login Button</a><a class="headerlink" href="#step-1-merchant-login-button" title="Permalink to this headline">¶</a></h3>
<p>The merchant must provide the user with a login button that links to
<code class="docutils literal notranslate"><span class="pre">https://wallet.org/login#${args}</span></code> where <cite>${args}`</cite> is a JSON object
containing following information and serialized as described below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;onetimekey&quot;</span> <span class="p">:</span> <span class="s2">&quot;$</span><span class="si">{SERVER_PUBLIC_KEY}</span><span class="s2">&quot;</span><span class="p">,</span>
   <span class="s2">&quot;account&quot;</span>  <span class="p">:</span> <span class="s2">&quot;$</span><span class="si">{OPT_ACCOUNT_NAME}</span><span class="s2">&quot;</span><span class="p">,</span>
   <span class="s2">&quot;callback&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://merchant.org/login_callback&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The merchant server will need to save the <code class="docutils literal notranslate"><span class="pre">${SERVER_PRIVATE_KEY}</span></code>
associated with the <code class="docutils literal notranslate"><span class="pre">${SERVER_PUBLIC_KEY}</span></code> in the user’s web session
in order to verify the login.</p>
</div>
<div class="section" id="step-2-compress-your-json-representation">
<h3><a class="toc-backref" href="#id5">Step 2 - Compress your JSON representation</a><a class="headerlink" href="#step-2-compress-your-json-representation" title="Permalink to this headline">¶</a></h3>
<p>Using <a class="reference external" href="https://github.com/nmrugg/LZMA-JS/">LZMA-JS</a> library to
compress the JSON into a binary array. This will be the most compact
form of the data. After running the compression the example JSON was
reduced to 281 bytes from 579 bytes.</p>
</div>
<div class="section" id="step-3-convert-to-base58">
<h3><a class="toc-backref" href="#id6">Step 3 - Convert to Base58</a><a class="headerlink" href="#step-3-convert-to-base58" title="Permalink to this headline">¶</a></h3>
<p>Using the <a class="reference external" href="http://cryptocoinjs.com/modules/misc/bs58/">bs58</a> library
encode the compressed data in base58. Base58 is URL friendly and size
efficient. After converting to base58 the string will be 385 characters
which can easily be passed in a URL and easily support much larger
invoices.</p>
</div>
<div class="section" id="step-4-wallet-confirmation">
<h3><a class="toc-backref" href="#id7">Step 4 - Wallet Confirmation</a><a class="headerlink" href="#step-4-wallet-confirmation" title="Permalink to this headline">¶</a></h3>
<p>When the user loads <code class="docutils literal notranslate"><span class="pre">https://wallet.org/login#${args}</span></code> they will be
prompted to confirm the login request by selecting an account that they
wish to login with. If “account” was specified in the <code class="docutils literal notranslate"><span class="pre">${args}</span></code> then
it will default to that account.</p>
<p>After the account is identified enough keys to authorize a account must
participate in the login process in the following way.</p>
<p>The wallet generates a <code class="docutils literal notranslate"><span class="pre">WALLET_ONETIMEKEY</span></code> and derives a <code class="docutils literal notranslate"><span class="pre">shared</span> <span class="pre">secret</span></code>
with the <code class="docutils literal notranslate"><span class="pre">SERVER_PUBLIC_KEY</span></code> provided by the <code class="docutils literal notranslate"><span class="pre">https://merchant.org</span></code> via
<code class="docutils literal notranslate"><span class="pre">${args}</span></code>. This shared secret is a provably “random” 512 bits of data that is
only known to the wallet at this point in time. The wallet then gathers
signatures on the shared secret from enough keys to authorize the account. In
the simple case this will be a single signature, but in more complex cases
multi-factor authentication may be required.</p>
<p>After gathering all of the signatures the wallet redirects the user to
<code class="docutils literal notranslate"><span class="pre">https://merchant.org/login_callback?a=${result}</span></code> where <code class="docutils literal notranslate"><span class="pre">result</span></code> is
an encoded JSON object containing the following information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;account&quot;</span><span class="p">:</span> <span class="s2">&quot;Graphene Account Name&quot;</span><span class="p">,</span>
   <span class="s2">&quot;server_key&quot;</span><span class="p">:</span> <span class="s2">&quot;$</span><span class="si">{SERVER_PUBLIC_KEY}</span><span class="s2">&quot;</span><span class="p">,</span>
   <span class="s2">&quot;account_key&quot;</span><span class="p">:</span> <span class="s2">&quot;$</span><span class="si">{WALLET_ONETIMEKEY}</span><span class="s2">&quot;</span><span class="p">,</span>
   <span class="s2">&quot;signatures&quot;</span> <span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;SIG1&quot;</span><span class="p">,</span> <span class="s2">&quot;SIG2&quot;</span><span class="p">,</span> <span class="o">..</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="step-5-server-verifies-authority">
<h3><a class="toc-backref" href="#id8">Step 5 - Server Verifies Authority</a><a class="headerlink" href="#step-5-server-verifies-authority" title="Permalink to this headline">¶</a></h3>
<p>Upon receiving the <code class="docutils literal notranslate"><span class="pre">result</span></code> from the wallet, <a class="reference external" href="https://merchant.org">https://merchant.org</a> will lookup
<code class="docutils literal notranslate"><span class="pre">{SERVER_PRIVATE_KEY}</span></code> in the user’s session data and then combine it with
<code class="docutils literal notranslate"><span class="pre">{WALLET_ONETIMEKEY}</span></code> to generate the <em>shared secret</em> that was used by the
wallet. Once this shared secret has been recovered, it can be used to recover
the public keys that correspond to the provided signatures.</p>
<p>The last step is to verify that the public keys provided by the
signatures are sufficient to authorize the account given the current
state of the graphene blockchain. This can be achieved using the witness
API call::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">verify_account_authority</span><span class="p">(</span> <span class="n">account_name_or_id</span><span class="p">,</span> <span class="p">[</span><span class="n">public_keys</span><span class="o">...</span><span class="p">]</span> <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">verify_account_authority</span></code> call will return <code class="docutils literal notranslate"><span class="pre">true</span></code> if the provided keys
have sufficient authority to authorize the account, otherwise it will return
<code class="docutils literal notranslate"><span class="pre">false</span></code></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="wallet-merchant-protocol">
<span id="merchants-case-wallet-merchant-protocol"></span><h2><a class="toc-backref" href="#id9">Wallet Merchant Protocol</a><a class="headerlink" href="#wallet-merchant-protocol" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this protocol is to enable a merchant to request payment from the
user via a hosted wallet provider or via a browser plugin. We will assume that
the wallet is hosted at <code class="docutils literal notranslate"><span class="pre">https://wallet.org</span></code> and that the merchant is hosted
at <code class="docutils literal notranslate"><span class="pre">https://merchant.org</span></code>.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>Privacy Concerns</strong></div>
<div class="line">The goal of this protocol is to maintain user and merchant privacy from the wallet provider which should never have direct access to the invoice data.</div>
</div>
</div></blockquote>
<p>To securely pass data from <code class="docutils literal notranslate"><span class="pre">https://merchant.org</span></code> to the javascript wallet
hosted at <code class="docutils literal notranslate"><span class="pre">https://wallet.org</span></code>, the data will have to be passed after the
<code class="docutils literal notranslate"><span class="pre">#</span></code>. Assuming the wallet provider is not serving up pages designed to
compromise your privacy, only your web browser will have access to the invoice
data.</p>
<div class="section" id="step-1-define-your-invoice-via-json">
<h3><a class="toc-backref" href="#id10">Step 1: Define your Invoice via JSON</a><a class="headerlink" href="#step-1-define-your-invoice-via-json" title="Permalink to this headline">¶</a></h3>
<p>This invoice provides all of the data needed by the wallet to display an invoice
to the user.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;to&quot;</span> <span class="p">:</span> <span class="s2">&quot;merchant_account_name&quot;</span><span class="p">,</span>
   <span class="s2">&quot;to_label&quot;</span> <span class="p">:</span> <span class="s2">&quot;Merchant Name&quot;</span><span class="p">,</span>
   <span class="s2">&quot;memo&quot;</span> <span class="p">:</span> <span class="s2">&quot;Invoice #1234&quot;</span><span class="p">,</span>
   <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;BTS&quot;</span><span class="p">,</span>
   <span class="s2">&quot;line_items&quot;</span> <span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;label&quot;</span> <span class="p">:</span> <span class="s2">&quot;Something to Buy&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="s2">&quot;1000.00 SYMBOL&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;label&quot;</span> <span class="p">:</span> <span class="s2">&quot;10 things to Buy&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="s2">&quot;1000.00 SYMBOL&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;label&quot;</span> <span class="p">:</span> <span class="s2">&quot;User Specified Price&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="s2">&quot;CUSTOM SYMBOL&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;label&quot;</span> <span class="p">:</span> <span class="s2">&quot;User Asset and Price&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span> <span class="p">:</span> <span class="s2">&quot;CUSTOM&quot;</span> <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;note&quot;</span> <span class="p">:</span> <span class="s2">&quot;Something the merchant wants to say to the user&quot;</span><span class="p">,</span>
    <span class="s2">&quot;callback&quot;</span> <span class="p">:</span> <span class="s2">&quot;https://merchant.org/complete&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By itself this data is 579 characters which after URL encoding is 916
characters, with a 2000 character limit this approach doesn’t scale as
well as we would like.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id11">Step 2: Compress your JSON representation</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Using <a class="reference external" href="https://github.com/nmrugg/LZMA-JS/">LZMA-JS</a> library to
compress the JSON into a binary array. This will be the most compact
form of the data. After running the compression the example JSON was
reduced to 281 bytes from 579 bytes.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id12">Step 3: Convert to Base58</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Using the <a class="reference external" href="http://cryptocoinjs.com/modules/misc/bs58/">bs58</a> library
encode the compressed data in base58. Base58 is URL friendly and size
efficient. After converting to base58 the string will be 385 characters
which can easily be passed in a URL and easily support much larger
invoices.</p>
</div>
<div class="section" id="step-4-pass-to-wallet">
<h3><a class="toc-backref" href="#id13">Step 4: Pass to Wallet</a><a class="headerlink" href="#step-4-pass-to-wallet" title="Permalink to this headline">¶</a></h3>
<p>Once the Base58 data is known, it can be passed to the wallet with the
following URL::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">wallet</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="c1">#/invoice/BASE58BLOB</span>
</pre></div>
</div>
</div>
<div class="section" id="step-5-receive-callback-from-wallet">
<h3><a class="toc-backref" href="#id14">Step 5: Receive Callback from Wallet</a><a class="headerlink" href="#step-5-receive-callback-from-wallet" title="Permalink to this headline">¶</a></h3>
<p>After the wallet has signed a transaction, broadcast it, and gotten
confirmation from <a class="reference external" href="https://wallet.org">https://wallet.org</a> that the transaction was included
in <code class="docutils literal notranslate"><span class="pre">block</span> <span class="pre">12345</span></code> as <code class="docutils literal notranslate"><span class="pre">transaction</span> <span class="pre">4</span></code> wallet will direct the user to
<code class="docutils literal notranslate"><span class="pre">https://merchant.org/complete?block=12345&amp;trx=4</span></code></p>
<p>The merchant will then request that transaction from
<code class="docutils literal notranslate"><span class="pre">https://wallet.org/api?block=12345&amp;trx=4</span></code> which will respond with the
transaction that was included in the blockchain. The merchant will decrypt the
memo from the transaction and use memo content to confirm payment for the
invoice.</p>
</div>
<div class="section" id="step-6-payment-complete">
<h3><a class="toc-backref" href="#id15">Step 6: Payment Complete</a><a class="headerlink" href="#step-6-payment-complete" title="Permalink to this headline">¶</a></h3>
<p>At this point the user has successfully made a payment and the merchant
has verified the payment has been received without having to maintain a
full node.</p>
</div>
<div class="section" id="example-python-script">
<h3><a class="toc-backref" href="#id16">Example Python script</a><a class="headerlink" href="#example-python-script" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">lzma</span>
<span class="kn">from</span> <span class="nn">graphenebase.base58</span> <span class="kn">import</span> <span class="n">base58encode</span><span class="p">,</span> <span class="n">base58decode</span>
<span class="kn">from</span> <span class="nn">binascii</span> <span class="kn">import</span> <span class="n">hexlify</span><span class="p">,</span> <span class="n">unhexlify</span>

<span class="n">invoice</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;bitshareseurope&quot;</span><span class="p">,</span>
    <span class="s2">&quot;to_label&quot;</span><span class="p">:</span> <span class="s2">&quot;BitShares Europre&quot;</span><span class="p">,</span>
    <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="s2">&quot;EUR&quot;</span><span class="p">,</span>
    <span class="s2">&quot;memo&quot;</span><span class="p">:</span> <span class="s2">&quot;Invoice #1234&quot;</span><span class="p">,</span>
    <span class="s2">&quot;line_items&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Something to Buy&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="s2">&quot;10.00&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;10 things to Buy&quot;</span><span class="p">,</span> <span class="s2">&quot;quantity&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="s2">&quot;1.00&quot;</span><span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="s2">&quot;Payment for reading awesome documentation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;callback&quot;</span><span class="p">:</span> <span class="s2">&quot;https://bitshares.eu/complete&quot;</span>
<span class="p">}</span>

<span class="n">compressed</span> <span class="o">=</span> <span class="n">lzma</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">invoice</span><span class="p">),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="n">lzma</span><span class="o">.</span><span class="n">FORMAT_ALONE</span><span class="p">)</span>
<span class="n">b58</span> <span class="o">=</span> <span class="n">base58encode</span><span class="p">(</span><span class="n">hexlify</span><span class="p">(</span><span class="n">compressed</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://bitshares.openledger.info/#/invoice/</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">b58</span>

<span class="k">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="uc_traders.html" class="btn btn-neutral float-right" title="Traders" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="uc_exchange_integration.html" class="btn btn-neutral" title="Exchanges, Bridges, and Gateways" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright BitShares Blockchain Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>