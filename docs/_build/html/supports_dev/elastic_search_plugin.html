

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ElasticSearch Plugin &mdash; BItShares Developers Portal  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> BItShares Developers Portal
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/architectures.html">Introduction &amp; Architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/environments.html">Development Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components/components.html">System Components Elements</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/installation.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bts_guide/accounts/bts_account.html">BitShares Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/integration.html">Integration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/interaction.html">Blockchain Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testnets.html">Testnets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/bsip.html">BitShares Improvement Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="supports.html">Support and Optimizations</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/api_about.html">1. API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/restrictions.html">2. API Access and Restrictions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/calls.html">3. Available Calls, Object, and IDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/blockchain_api.html">4. Blockchain API(s)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/wallet_api.html">5. Wallet API - Calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/objects_ids.html">6. Objects and IDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/namespaces.html">7. Graphene - Namespaces</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bts_guide/tutorials/index.html">Developer Guide (Tutorials)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bts_guide/index_faq.html">Frequently Asked Questions (FAQ)</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../references/info_comunities.html">BitShares Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/info_comunities.html#bitshares-blockchain">BitShares Blockchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/info_bbf_events.html">BitShares Blockchain Foundation Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/tech_articles.html">BitShares Developers’ Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/tech_articles.html#articles">Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/githubrepo.html">BitShares Repositories</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BItShares Developers Portal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>ElasticSearch Plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="elasticsearch-plugin">
<span id="elastic-search"></span><h1>ElasticSearch Plugin<a class="headerlink" href="#elasticsearch-plugin" title="Permalink to this headline">¶</a></h1>
<p>ElasticSearch Plugin v1</p>
<p>The document explains motivations, technical challenges and sample use of a new plug-in created for bitshares to store account history data into an elasticsearch database.</p>
<hr class="docutils" />
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#motivation" id="id1">Motivation</a></li>
<li><a class="reference internal" href="#the-database-selection" id="id2">The Database Selection</a></li>
<li><a class="reference internal" href="#technical" id="id3">Technical</a><ul>
<li><a class="reference internal" href="#replay-and-bulk" id="id4">Replay and _bulk</a></li>
<li><a class="reference internal" href="#accessing-data-inside-operations" id="id5">Accessing data inside operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation" id="id6">Installation</a><ul>
<li><a class="reference internal" href="#install-java" id="id7">Install java:</a></li>
<li><a class="reference internal" href="#install-es" id="id8">Install ES:</a></li>
<li><a class="reference internal" href="#install-curl" id="id9">Install curl</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running" id="id10">Running</a><ul>
<li><a class="reference internal" href="#arguments" id="id11">Arguments</a></li>
<li><a class="reference internal" href="#starting-node" id="id12">Starting Node</a></li>
<li><a class="reference internal" href="#checking-if-it-is-working" id="id13">Checking if it is working</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indexes" id="id14">Indexes</a></li>
<li><a class="reference internal" href="#pre-define-settings" id="id15">Pre-Define Settings</a></li>
<li><a class="reference internal" href="#usage" id="id16">Usage</a><ul>
<li><a class="reference internal" href="#get-operations-by-account-time-and-operation-type" id="id17">Get operations by account, time and operation type</a></li>
<li><a class="reference internal" href="#filter-based-on-block-number-or-block-range" id="id18">Filter based on block number or block range</a></li>
<li><a class="reference internal" href="#get-operations-by-transaction-hash" id="id19">Get operations by transaction hash</a></li>
</ul>
</li>
<li><a class="reference internal" href="#going-forward" id="id20">Going forward</a><ul>
<li><a class="reference internal" href="#more-visitor-code-more-indexed-data-more-filters-to-use" id="id21">More visitor code = more indexed data = more filters to use</a></li>
</ul>
</li>
<li><a class="reference internal" href="#note-on-duplicates" id="id22">Note on Duplicates</a></li>
<li><a class="reference internal" href="#wrapper" id="id23">Wrapper</a></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="motivation">
<h2><a class="toc-backref" href="#id1">Motivation</a><a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>There are 2 main problems this plug-in tries to solve:</p>
<ul class="simple">
<li>The amount of RAM needed to run a full node. Current options for this are basically store account history: yes/no, store some of the account history, track history for specific accounts, etc. Plugin allows to have all the account history data without the amount of RAM required in current implementation.</li>
<li>The number of github issues in regards to new api calls to lookup account history in different ways. elasticsearch-plugin will allow users to search account history querying directly into the database without the bitshares-core team creating and maintaining API calls for every case.</li>
</ul>
<p>Additionally we are after a secure way to store error free full account data. The huge amount of operations data involved in bitshares blockchain and the way it is serialized makes this a big challenge.</p>
<p>Even more, saving data to Elastic Search database(from now on: ES) will bring additional value to clients connected to the new full node with real time statistics and fast access to data.</p>
</div>
<div class="section" id="the-database-selection">
<h2><a class="toc-backref" href="#id2">The Database Selection</a><a class="headerlink" href="#the-database-selection" title="Permalink to this headline">¶</a></h2>
<p>Elastic search was selected for the main following reasons:</p>
<ul class="simple">
<li>open source.</li>
<li>fast.</li>
<li>index oriented.</li>
<li>easy to install and start using.</li>
<li>send data from c++ using curl.</li>
<li>scalable and decentralized nodes of data.</li>
</ul>
</div>
<div class="section" id="technical">
<h2><a class="toc-backref" href="#id3">Technical</a><a class="headerlink" href="#technical" title="Permalink to this headline">¶</a></h2>
<p>The <cite>elasticsearch-plugin</cite> is uses the basics of <cite>account_history_plugin</cite>.</p>
<p>Here is how the current account_history plugin works basically:</p>
<ul class="simple">
<li>with every signed block arriving to the plugin the ops are extracted from it.</li>
<li>each op is added to ohi(operation history index) and to ath(account transaction history index).</li>
<li>both indexes keep growing as new block gets in.</li>
<li>with the memory reduction techniques currently available the 2 indexes can remove early ops of accounts reducing ram size.</li>
</ul>
<p>And now what <cite>elasticsearch-plugin</cite> attempts to do:</p>
<ul class="simple">
<li>with every signed block arriving to the plugin the ops are extracted from it, just as in account_history.</li>
<li>create indexes ohi and ath and store current op there just as account history do. this a temp indexation of 1 op only that is done to remain compatible with the previous numbers used as id(1.11.X and 2.9.X).</li>
<li>send ath and ohi plus additional block data and visitor data into ES(actually we send them in bulks not one by one as we will explain below).</li>
<li>remove everything in the compatibility temporal indexes except for current operation. This way the indexes always have just 1 item and don’t use any ram.</li>
</ul>
<div class="section" id="replay-and-bulk">
<h3><a class="toc-backref" href="#id4">Replay and _bulk</a><a class="headerlink" href="#replay-and-bulk" title="Permalink to this headline">¶</a></h3>
<p>As mentioned we don’t send to ES the operations one by one, this is because in a replay the number of ops will be so big that performance will decrease drastically and time to be in sync will be too much. For this reason we use the ES bulk api and send by default 10000 lines when we are in replay and downgrade this to 100 lines after we are in sync.</p>
<p>ES bulk format is one line of meta-data and one line of data itself, so 10000 is actually 2500 operations we send on every bulk and 100 is actually 50 ops in real time mode.</p>
<p>This values are available as plugin options to the user to change.</p>
<p>The optimal number of docs to bulk is hardware dependent.</p>
<p>The name of the created index in ES will be <cite>graphene</cite></p>
</div>
<div class="section" id="accessing-data-inside-operations">
<h3><a class="toc-backref" href="#id5">Accessing data inside operations</a><a class="headerlink" href="#accessing-data-inside-operations" title="Permalink to this headline">¶</a></h3>
<p>There are cases where data coming from account transaction history index, operation history index and block data is not enough. We may want to index fields inside operations themselves like the fees, the asset id or the amount of transfer to make fast queries into them.</p>
<p>Data inside operations is saved as a text fields into ES, this means that we can’t fast search into them as the data is not indexed, we can, still search by other data and filter converting the op text to json in client side. This is possible and relatively easy so please consider.</p>
<p>Still, a workaround the limitation is available. A <cite>visitor</cite> that can be turned on/off by the command line. As an example something in common all ops have is a fee field with asset_id and amount. In <cite>elasticserch-plugin</cite> v1 when visitor is <cite>true</cite> this 2 values will be saved meaning clients can know total chain fees collected in real time, total fees in asset, fees by op among other things.</p>
<p>As a poc we also added amount and asset_id of transfer operations to illustrate how easy is to index more data for any competent graphene developer.</p>
<p>## Hardware needed</p>
<p>It is very recommended that you use SSD disks in your node if you are trying to synchronize bitshares blockchain. It will make the task a lot faster.</p>
<p>You need 500 gigs of space to be safe for a while, 32 gigs or more of ram is recommended.</p>
<p>After elasticsearch is installed increase heap size depending in your RAM:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>elastic@alfredo-worker2:~/elasticsearch-5.6.3/config$ vi jvm.options
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">..</span>
<span class="c1"># Xms represents the initial size of total heap space</span>
<span class="c1"># Xmx represents the maximum size of total heap space</span>

<span class="o">-</span><span class="n">Xms12g</span>
<span class="o">-</span><span class="n">Xmx12g</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installation">
<h2><a class="toc-backref" href="#id6">Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Basically there are 2 things you need: elasticsearch and curl for c++. elasticsearch need java so those are the 3 things you will need to have. The following are instructions tested in debian(ubuntu - mint) based linux versions.</p>
<div class="section" id="install-java">
<h3><a class="toc-backref" href="#id7">Install java:</a><a class="headerlink" href="#install-java" title="Permalink to this headline">¶</a></h3>
<p>download the jre, add sudo to the start of the commands if installing from a non root user::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">default</span><span class="o">-</span><span class="n">jre</span>
</pre></div>
</div>
<p>we are going to need the jdk too:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">default</span><span class="o">-</span><span class="n">jdk</span>
</pre></div>
</div>
<p>add repository to install oracle java8:</p>
<p>in ubuntu:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="n">ppa</span><span class="p">:</span><span class="n">webupd8team</span><span class="o">/</span><span class="n">java</span>
</pre></div>
</div>
<p>in debian:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="s2">&quot;deb http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main&quot;</span>
</pre></div>
</div>
<p>then: <cite>apt-get update</cite></p>
<p>if you don’t have add-apt-repository command you can install it by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">software</span><span class="o">-</span><span class="n">properties</span><span class="o">-</span><span class="n">common</span>
</pre></div>
</div>
<p>install java 8:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">oracle</span><span class="o">-</span><span class="n">java8</span><span class="o">-</span><span class="n">installer</span>
</pre></div>
</div>
</div>
<div class="section" id="install-es">
<h3><a class="toc-backref" href="#id8">Install ES:</a><a class="headerlink" href="#install-es" title="Permalink to this headline">¶</a></h3>
<p>Get version 6 file at: <a class="reference external" href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.0.zip">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.0.zip</a></p>
<p><strong>Note:</strong> Plugin works with currently last stable version of elastic(6.2.0)</p>
<p>Please do this as a non root user as ES will not run as root.</p>
<p>download as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.2.0.zip`
</pre></div>
</div>
<p>unzip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`unzip elasticsearch-6.2.0.zip`
</pre></div>
</div>
<p>and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="mf">6.2</span><span class="o">.</span><span class="mf">0.</span><span class="n">zip</span><span class="o">/</span>
<span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">elasticsearch</span>
</pre></div>
</div>
<p>You can put this as a service, the binary haves a <cite>–daemonize</cite> option, can run inside screen or any other option that suits you in order to keep the database running.</p>
<p>Please note ES does not run a the root user, if you are a root user you need to first make a normal user account by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`adduser elastic`
</pre></div>
</div>
<p>After created: <cite>su elastic</cite>. Execute the <cite>wget</cite> and <cite>unzip</cite> commands from above as normal user in created user home dir.</p>
</div>
<div class="section" id="install-curl">
<h3><a class="toc-backref" href="#id9">Install curl</a><a class="headerlink" href="#install-curl" title="Permalink to this headline">¶</a></h3>
<p>We need curl to send requests from the c++ plugin into the ES database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libcurl4</span><span class="o">-</span><span class="n">openssl</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running">
<h2><a class="toc-backref" href="#id10">Running</a><a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h2>
<p>Make sure ES is running, can start it by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">elasticsearch</span> <span class="o">--</span><span class="n">daemonize</span>
</pre></div>
</div>
<p>ES will listen on localhost port 9200 <cite>127.0.0.1:9200</cite></p>
<p>Clone repo and install bitshares:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/bitshares/bitshares-core
cd bitshares-core
git submodule update --init --recursive
BOOST_ROOT=$HOME/opt/boost_1_63_0
cmake -DBOOST_ROOT=&quot;$BOOST_ROOT&quot; -DCMAKE_BUILD_TYPE=RelWithDebInfo .
make
</pre></div>
</div>
<div class="section" id="arguments">
<h3><a class="toc-backref" href="#id11">Arguments</a><a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h3>
<p>The ES plugin have the following parameters passed by command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">parameter</span> <span class="o">|</span>    <span class="o">|</span>
<span class="o">|-----------|----|</span>
<span class="o">|</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="n">node</span><span class="o">-</span><span class="n">url</span> <span class="o">|</span> <span class="n">The</span> <span class="n">url</span> <span class="n">od</span> <span class="n">elasticsearch</span> <span class="o">-</span> <span class="n">default</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">9200</span><span class="o">/</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="n">bulk</span><span class="o">-</span><span class="n">replay</span> <span class="o">|</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">lines</span><span class="p">(</span><span class="n">ops</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">send</span> <span class="n">to</span> <span class="n">database</span> <span class="ow">in</span> <span class="n">replay</span> <span class="n">state</span> <span class="o">-</span> <span class="n">default</span><span class="p">:</span> <span class="mi">10000</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="n">bulk</span><span class="o">-</span><span class="n">sync</span> <span class="o">|</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">lines</span><span class="p">(</span><span class="n">ops</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="n">to</span> <span class="n">send</span> <span class="n">to</span> <span class="n">database</span> <span class="n">at</span> <span class="n">syncronized</span> <span class="n">state</span> <span class="o">-</span> <span class="n">default</span><span class="p">:</span> <span class="mi">100</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="n">logs</span> <span class="o">|</span> <span class="n">Save</span> <span class="n">logs</span> <span class="n">to</span> <span class="n">database</span> <span class="o">-</span> <span class="n">default</span><span class="p">:</span> <span class="n">true</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">elasticsearch</span><span class="o">-</span><span class="n">visitor</span> <span class="o">|</span> <span class="n">Index</span> <span class="n">visitor</span> <span class="n">additional</span> <span class="n">inside</span> <span class="n">op</span> <span class="n">data</span> <span class="o">-</span> <span class="n">default</span><span class="p">:</span> <span class="n">true</span> <span class="o">|</span>
</pre></div>
</div>
</div>
<div class="section" id="starting-node">
<h3><a class="toc-backref" href="#id12">Starting Node</a><a class="headerlink" href="#starting-node" title="Permalink to this headline">¶</a></h3>
<p>ES plugin is not active by default, we need to start it with the plugins parameter. An example of starting a node with ES plugin may be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">programs</span><span class="o">/</span><span class="n">witness_node</span><span class="o">/</span><span class="n">witness_node</span> <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="nb">dir</span> <span class="n">data</span><span class="o">/</span><span class="n">my</span><span class="o">-</span><span class="n">blockprod</span>
                                   <span class="o">--</span><span class="n">rpc</span><span class="o">-</span><span class="n">endpoint</span> <span class="s2">&quot;127.0.0.1:8090&quot;</span>
                                   <span class="o">--</span><span class="n">plugins</span> <span class="s2">&quot;witness elasticsearch market_history&quot;</span>
                                   <span class="o">--</span><span class="n">elasticsearch</span><span class="o">-</span><span class="n">bulk</span><span class="o">-</span><span class="n">replay</span> <span class="mi">10000</span>
                                   <span class="o">--</span><span class="n">elasticsearch</span><span class="o">-</span><span class="n">logs</span> <span class="n">true</span>
                                   <span class="o">--</span><span class="n">elasticsearch</span><span class="o">-</span><span class="n">visitor</span> <span class="n">true</span>
</pre></div>
</div>
<p><strong>Note:</strong> elasticsearch plugin and account_history plugin can not run the 2 at the same time.</p>
</div>
<div class="section" id="checking-if-it-is-working">
<h3><a class="toc-backref" href="#id13">Checking if it is working</a><a class="headerlink" href="#checking-if-it-is-working" title="Permalink to this headline">¶</a></h3>
<p>A few minutes after the node start the first batch of 5000 ops will be inserted to the database. If you are in a desktop linux you may want to install <a class="reference external" href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a> and see the database from the web browser to make sure if it is working. This is optional.</p>
<p>If you only have command line available you can query the database directly throw curl as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@NC</span><span class="o">-</span><span class="n">PH</span><span class="o">-</span><span class="mi">1346</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span><span class="o">~/</span><span class="n">bitshares</span><span class="o">/</span><span class="n">elastic</span><span class="o">/</span><span class="n">bitshares</span><span class="o">-</span><span class="n">core</span><span class="c1"># curl -X GET &#39;http://localhost:9200/graphene-*/data/_count?pretty=true&#39; -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="p">{</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;match_all&quot;</span><span class="p">:</span> <span class="p">{}}]</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="s1">&#39;</span>
<span class="p">{</span>
  <span class="s2">&quot;count&quot;</span> <span class="p">:</span> <span class="mi">360000</span><span class="p">,</span>
  <span class="s2">&quot;_shards&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;total&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;successful&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;skipped&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;failed&quot;</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">root</span><span class="nd">@NC</span><span class="o">-</span><span class="n">PH</span><span class="o">-</span><span class="mi">1346</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span><span class="o">~/</span><span class="n">bitshares</span><span class="o">/</span><span class="n">elastic</span><span class="o">/</span><span class="n">bitshares</span><span class="o">-</span><span class="n">core</span><span class="c1">#</span>
</pre></div>
</div>
<p>360000 records are inserted at this point of the replay in ES, means it is working.</p>
<p><strong>Important: Replay with ES plugin will be always slower than the “save to ram” `account_history_plugin` so expect to wait more to be in sync than usual.</strong></p>
<p>A synchronized node will look like this(screen capture 20/12/2017):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@NC</span><span class="o">-</span><span class="n">PH</span><span class="o">-</span><span class="mi">1346</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X GET &#39;http://localhost:9200/graphene-*/data/_count?pretty=true&#39; -H &#39;Content-Type: application/json&#39; -d &#39;</span>
<span class="p">{</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;match_all&quot;</span><span class="p">:</span> <span class="p">{}}]</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="s1">&#39;</span>
<span class="p">{</span>
  <span class="s2">&quot;count&quot;</span> <span class="p">:</span> <span class="mi">107156155</span><span class="p">,</span>
  <span class="s2">&quot;_shards&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;total&quot;</span> <span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
    <span class="s2">&quot;successful&quot;</span> <span class="p">:</span> <span class="mi">135</span><span class="p">,</span>
    <span class="s2">&quot;skipped&quot;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;failed&quot;</span> <span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">root</span><span class="nd">@NC</span><span class="o">-</span><span class="n">PH</span><span class="o">-</span><span class="mi">1346</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span><span class="o">~</span><span class="c1">#</span>
</pre></div>
</div>
<p><strong>Important: We have reports of the need of more than 200G of disk space at 2018-03-20 to save all the history and the logs for them. Please make sure you have enough disk before synchronizing.</strong></p>
<p><strong>Important: The synchronization of a full live blockchain from scratch can take up to 3 days! Please be prepared for big waiting time.</strong></p>
</div>
</div>
<div class="section" id="indexes">
<h2><a class="toc-backref" href="#id14">Indexes</a><a class="headerlink" href="#indexes" title="Permalink to this headline">¶</a></h2>
<p>The plugin creates monthly indexes in the ES database, index names are as graphene-2016-05 and contain all the operations made inside the monthly period.</p>
<p>List your indexes as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NC</span><span class="o">-</span><span class="n">PH</span><span class="o">-</span><span class="mi">1346</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span><span class="o">~</span><span class="c1"># curl -X GET &#39;http://localhost:9200/_cat/indices&#39;</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">logs</span>             <span class="n">PvSvmtcFSCCF_</span><span class="o">-</span><span class="mi">3</span><span class="n">HBjJaXg</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">358808</span> <span class="mi">0</span>   <span class="mf">5.8</span><span class="n">gb</span>   <span class="mf">5.8</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">09</span> <span class="n">ZUUi5xeuTeSb7QPP1Pnk0A</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">11075939</span> <span class="mi">0</span>   <span class="mf">8.4</span><span class="n">gb</span>   <span class="mf">8.4</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">04</span> <span class="n">HtCKnM_UTLyDWBR7</span><span class="o">-</span><span class="n">PopGQ</span> <span class="mi">5</span> <span class="mi">1</span>  <span class="mi">3316120</span> <span class="mi">0</span>   <span class="mf">2.4</span><span class="n">gb</span>   <span class="mf">2.4</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">10</span> <span class="n">SAUFtI0CRx6MnISukeqA</span><span class="o">-</span><span class="n">Q</span> <span class="mi">5</span> <span class="mi">1</span>  <span class="mi">9326346</span> <span class="mi">0</span>   <span class="mf">7.1</span><span class="n">gb</span>   <span class="mf">7.1</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">07</span> <span class="n">CTWIim51SZy0Ir55sjlT7w</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">17890903</span> <span class="mi">0</span>  <span class="mf">12.8</span><span class="n">gb</span>  <span class="mf">12.8</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">01</span> <span class="n">sna676yfR1OT5ww9HRiVZw</span> <span class="mi">5</span> <span class="mi">1</span>  <span class="mi">1197124</span> <span class="mi">0</span> <span class="mf">917.7</span><span class="n">mb</span> <span class="mf">917.7</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">06</span> <span class="n">FZ_FyTLwQCKObjKgLQcF3w</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">656358</span> <span class="mi">0</span> <span class="mf">473.9</span><span class="n">mb</span> <span class="mf">473.9</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">03</span> <span class="n">Ogsw0PlbRAWeHRS86o4vTA</span> <span class="mi">5</span> <span class="mi">1</span>  <span class="mi">2167788</span> <span class="mi">0</span>   <span class="mf">1.6</span><span class="n">gb</span>   <span class="mf">1.6</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">11</span> <span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="n">oz</span><span class="o">-</span><span class="n">DRRTOMLdZVOUV5xw</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">14107174</span> <span class="mi">0</span>  <span class="mf">10.8</span><span class="n">gb</span>  <span class="mf">10.8</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">02</span> <span class="n">ZE3LxFWkTeO7CBsxMMmIFQ</span> <span class="mi">5</span> <span class="mi">1</span>  <span class="mi">1104282</span> <span class="mi">0</span> <span class="mf">822.4</span><span class="n">mb</span> <span class="mf">822.4</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">12</span> <span class="n">bZRFc5aLSlqbBMYEnKmF7Q</span> <span class="mi">5</span> <span class="mi">1</span>  <span class="mi">8758628</span> <span class="mi">0</span>     <span class="mi">8</span><span class="n">gb</span>     <span class="mi">8</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2015</span><span class="o">-</span><span class="mi">11</span> <span class="n">iXyIZkj_T0O</span><span class="o">-</span><span class="n">NjPxEf0L_A</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">301079</span> <span class="mi">0</span> <span class="mf">193.1</span><span class="n">mb</span> <span class="mf">193.1</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">05</span> <span class="n">ipVA6yEKTH68nEucBIZP7w</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">10278394</span> <span class="mi">0</span>   <span class="mf">7.5</span><span class="n">gb</span>   <span class="mf">7.5</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">08</span> <span class="n">Z2C_pciwQSevJzcl9kRhhQ</span> <span class="mi">5</span> <span class="mi">1</span>  <span class="mi">9916248</span> <span class="mi">0</span>   <span class="mf">7.5</span><span class="n">gb</span>   <span class="mf">7.5</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">04</span> <span class="n">vtQSi</span><span class="o">-</span><span class="n">kdQ0OblRq2naPu</span><span class="o">-</span><span class="n">A</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">413798</span> <span class="mi">0</span> <span class="mf">297.4</span><span class="n">mb</span> <span class="mf">297.4</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">12</span> <span class="n">hsohZ0cfTGSPPVWUM_Fgeg</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">917034</span> <span class="mi">0</span> <span class="mf">711.3</span><span class="n">mb</span> <span class="mf">711.3</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">01</span> <span class="n">PzjbXCXFShCzZFyTBgv2IQ</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">372772</span> <span class="mi">0</span> <span class="mf">247.1</span><span class="n">mb</span> <span class="mf">247.1</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">03</span> <span class="mi">8</span><span class="n">j1yyLIeTUWXb6TZntqQhg</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">597461</span> <span class="mi">0</span>   <span class="mi">431</span><span class="n">mb</span>   <span class="mi">431</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">08</span> <span class="mi">6</span><span class="n">qBByeOPSkCDqWYrOR_qPg</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">551835</span> <span class="mi">0</span> <span class="mf">389.3</span><span class="n">mb</span> <span class="mf">389.3</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2015</span><span class="o">-</span><span class="mi">10</span> <span class="n">DTHVtNpIT2KAoMiO4</span><span class="o">-</span><span class="n">c61w</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">161004</span> <span class="mi">0</span> <span class="mf">122.2</span><span class="n">mb</span> <span class="mf">122.2</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2017</span><span class="o">-</span><span class="mi">06</span> <span class="n">Jei8GvRYSkif4zZ</span><span class="o">-</span><span class="n">V9mFRg</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">10795239</span> <span class="mi">0</span>   <span class="mf">8.1</span><span class="n">gb</span>   <span class="mf">8.1</span><span class="n">gb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="o">.</span><span class="n">kibana</span>          <span class="mi">8</span><span class="n">q5behLlQRi_hxKSWurYDw</span> <span class="mi">1</span> <span class="mi">1</span>        <span class="mi">7</span> <span class="mi">0</span>  <span class="mf">42.7</span><span class="n">kb</span>  <span class="mf">42.7</span><span class="n">kb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">05</span> <span class="n">s7Ie2crTS_uismCP5U2dIQ</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">498493</span> <span class="mi">0</span> <span class="mf">353.4</span><span class="n">mb</span> <span class="mf">353.4</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span> <span class="mi">7</span><span class="n">yx03R2hQX6XyOR8Sdu7ZA</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">609087</span> <span class="mi">0</span> <span class="mf">435.8</span><span class="n">mb</span> <span class="mf">435.8</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">02</span> <span class="mi">0</span><span class="n">SVSrhn3QK2AxWNv9NRASQ</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">468174</span> <span class="mi">0</span> <span class="mf">321.8</span><span class="n">mb</span> <span class="mf">321.8</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">10</span> <span class="n">C28juWi8Rf</span><span class="o">-</span><span class="mi">1</span><span class="n">A0h2YnShBw</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">416570</span> <span class="mi">0</span> <span class="mf">299.9</span><span class="n">mb</span> <span class="mf">299.9</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">09</span> <span class="mi">3</span><span class="n">rHI_5HFR3SFl9bhroL5EA</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">409164</span> <span class="mi">0</span> <span class="mf">296.1</span><span class="n">mb</span> <span class="mf">296.1</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2015</span><span class="o">-</span><span class="mi">12</span> <span class="n">aLlUxO_tSG</span><span class="o">-</span><span class="n">CMC3SPcFgkw</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">349985</span> <span class="mi">0</span> <span class="mf">222.4</span><span class="n">mb</span> <span class="mf">222.4</span><span class="n">mb</span>
<span class="n">yellow</span> <span class="nb">open</span> <span class="n">graphene</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mi">11</span> <span class="n">i00upS94Ruii1zJYXI0S9Q</span> <span class="mi">5</span> <span class="mi">1</span>   <span class="mi">495556</span> <span class="mi">0</span> <span class="mf">367.3</span><span class="n">mb</span> <span class="mf">367.3</span><span class="n">mb</span>
<span class="n">root</span><span class="nd">@NC</span><span class="o">-</span><span class="n">PH</span><span class="o">-</span><span class="mi">1346</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span><span class="o">~</span><span class="c1">#</span>
</pre></div>
</div>
<p>If you don’t see any index here then something is wrong with the bitshares-core node setup with elasticsearch plugin.</p>
</div>
<div class="section" id="pre-define-settings">
<h2><a class="toc-backref" href="#id15">Pre-Define Settings</a><a class="headerlink" href="#pre-define-settings" title="Permalink to this headline">¶</a></h2>
<p>By default data indexes will be created with default elasticsearch settings. Node owner can tweak the default settings for all the graphene-* indexes before the addition of any data.</p>
<p>An example of a good index configuration is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl -XPUT &#39;http://localhost:9200/_template/graphene&#39; -d &#39;{
  &quot;index_patterns&quot; : [&quot;graphene-*&quot;],
  &quot;settings&quot;: { &quot;number_of_shards&quot;: 2,
    &quot;index&quot;: {
      &quot;translog&quot;: {
        &quot;retention&quot;: {
          &quot;size&quot;: &quot;512mb&quot;, &quot;age&quot;: &quot;300s&quot;
        }
      }
    }
  }
}&#39; -H &#39;Content-Type: application/json
</pre></div>
</div>
<p>&#64;HarukaMa said: “This template would apply those settings to all newly created index prefixed with graphene-. It’s one time so there will be no need to specify them for every new index. In this settings I have also reduced translog age to 15min to minimize the storage usage, but I think that’s optional.”</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id16">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>After your node is in sync you are in possession of a full node without the ram issues. A synchronized witness_node with ES will be using less than 10 gigs of ram:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">total</span>          <span class="mi">9817628</span><span class="n">K</span>
<span class="n">root</span><span class="nd">@NC</span><span class="o">-</span><span class="n">PH</span><span class="o">-</span><span class="mi">1346</span><span class="o">-</span><span class="mi">07</span><span class="p">:</span><span class="o">~</span><span class="c1"># pmap 2183</span>
</pre></div>
</div>
<p>Compare against a traditional full node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> total         60522044K
[bitshares@lantea ~]$
</pre></div>
</div>
<p>Please note start command was with <cite>markets_history</cite> plugin activated, only consensus data should use even less than 10 gigs.</p>
<p>What client side apps can do with this new data is kind of unlimited to client developer imagination but lets check some real world examples to see the benefits of this new feature.</p>
<div class="section" id="get-operations-by-account-time-and-operation-type">
<h3><a class="toc-backref" href="#id17">Get operations by account, time and operation type</a><a class="headerlink" href="#get-operations-by-account-time-and-operation-type" title="Permalink to this headline">¶</a></h3>
<p>References:
- <a class="reference external" href="https://github.com/bitshares/bitshares-core/issues/358">https://github.com/bitshares/bitshares-core/issues/358</a>
- <a class="reference external" href="https://github.com/bitshares/bitshares-core/issues/413">https://github.com/bitshares/bitshares-core/issues/413</a>
- <a class="reference external" href="https://github.com/bitshares/bitshares-core/pull/405">https://github.com/bitshares/bitshares-core/pull/405</a>
- <a class="reference external" href="https://github.com/bitshares/bitshares-core/pull/379">https://github.com/bitshares/bitshares-core/pull/379</a>
- <a class="reference external" href="https://github.com/bitshares/bitshares-core/pull/430">https://github.com/bitshares/bitshares-core/pull/430</a>
- <a class="reference external" href="https://github.com/bitshares/bitshares-ui/issues/68">https://github.com/bitshares/bitshares-ui/issues/68</a></p>
<p>This is one of the issues that has been requested constantly. It can be easily queried with ES plugin by calling the _search endpoint doing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">GET</span> <span class="s1">&#39;http://localhost:9200/graphene-*/data/_search?pretty=true&#39;</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span>
<span class="p">{</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;account_history.account.keyword&quot;</span><span class="p">:</span> <span class="s2">&quot;1.2.282&quot;</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;block_data.block_time&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gte&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-10-26T00:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;lte&quot;</span><span class="p">:</span> <span class="s2">&quot;2015-10-29T23:59:59&quot;</span><span class="p">}}}]</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="s1">&#39;</span>
</pre></div>
</div>
<p><strong>Note:</strong> Response is removed from the samples to save space in the document. If you are here you may want to see the response in your own place.</p>
</div>
<div class="section" id="filter-based-on-block-number-or-block-range">
<h3><a class="toc-backref" href="#id18">Filter based on block number or block range</a><a class="headerlink" href="#filter-based-on-block-number-or-block-range" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/bitshares/bitshares-core/issues/61">https://github.com/bitshares/bitshares-core/issues/61</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">GET</span> <span class="s1">&#39;http://localhost:9200/graphene-*/data/_search?pretty=true&#39;</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span>
<span class="p">{</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;account_history.account.keyword&quot;</span><span class="p">:</span> <span class="s2">&quot;1.2.356589&quot;</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;block_data.block_num&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;gte&quot;</span><span class="p">:</span> <span class="s2">&quot;17824289&quot;</span><span class="p">,</span> <span class="s2">&quot;lte&quot;</span><span class="p">:</span> <span class="s2">&quot;17824290&quot;</span><span class="p">}</span>
<span class="p">}}]</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="get-operations-by-transaction-hash">
<h3><a class="toc-backref" href="#id19">Get operations by transaction hash</a><a class="headerlink" href="#get-operations-by-transaction-hash" title="Permalink to this headline">¶</a></h3>
<p>Refs: <a class="reference external" href="https://github.com/bitshares/bitshares-core/pull/373">https://github.com/bitshares/bitshares-core/pull/373</a></p>
<p>The <cite>get_transaction_id</cite> can be done as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">GET</span> <span class="s1">&#39;http://localhost:9200/graphene-*/data/_search?pretty=true&#39;</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span>
<span class="p">{</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;block_data.block_num&quot;</span><span class="p">:</span> <span class="mi">19421114</span><span class="p">}},{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;operation_history.trx_in_block&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}]</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="s1">&#39;</span>
</pre></div>
</div>
<p>The above will return all ops inside trx, if you only need the trx_id field you can add <cite>source</cite> and just return the fields you need:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">GET</span> <span class="s1">&#39;http://localhost:9200/graphene-*/data/_search?pretty=true&#39;</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span>
<span class="p">{</span>
    <span class="s2">&quot;_source&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;block_data.trx_id&quot;</span><span class="p">],</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;block_data.block_num&quot;</span><span class="p">:</span> <span class="mi">19421114</span><span class="p">}},{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;operation_history.trx_in_block&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}}]</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="s1">&#39;</span>
</pre></div>
</div>
<p>The <cite>get_transaction_from_id</cite> is very easy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">GET</span> <span class="s1">&#39;http://localhost:9200/graphene-*/data/_search?pretty=true&#39;</span> <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/json&#39;</span> <span class="o">-</span><span class="n">d</span> <span class="s1">&#39;</span>
<span class="p">{</span>
    <span class="s2">&quot;query&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bool&quot;</span> <span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;must&quot;</span> <span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;term&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;block_data.trx_id&quot;</span><span class="p">:</span> <span class="s2">&quot;6f2d5064637391089127aa9feb36e2092347466c&quot;</span><span class="p">}}]</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="s1">&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="going-forward">
<h2><a class="toc-backref" href="#id20">Going forward</a><a class="headerlink" href="#going-forward" title="Permalink to this headline">¶</a></h2>
<p>The reader will need to learn more about elasticsearch and lucene query language in order to make more complex queries.</p>
<p>All needed can be found at <a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.2/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/6.2/index.html</a></p>
<p>By the same team of elasticsearch there is a front end named kibana (<a class="reference external" href="https://www.elastic.co/products/kibana">https://www.elastic.co/products/kibana</a>). It is very easy to install and can do pretty good stuff like getting very detailed stats of the blockchain network.</p>
<div class="section" id="more-visitor-code-more-indexed-data-more-filters-to-use">
<h3><a class="toc-backref" href="#id21">More visitor code = more indexed data = more filters to use</a><a class="headerlink" href="#more-visitor-code-more-indexed-data-more-filters-to-use" title="Permalink to this headline">¶</a></h3>
<p>Just as an example, it will be easy to index asset of trading operations by extending the visitor code of them. point 3 of <a class="reference external" href="https://github.com/bitshares/bitshares-core/issues/358">https://github.com/bitshares/bitshares-core/issues/358</a> request trading pair, can be solved by indexing the asset of the trading ops as mentioned.</p>
<p>Remember ES already have all the needed info in the op text field of the operation_history object. Client can get all the ops of an account, loop throw them and convert the op string into json being able to filter by the asset or any other field needed. There is no need to index everything but it is possible.</p>
</div>
</div>
<div class="section" id="note-on-duplicates">
<h2><a class="toc-backref" href="#id22">Note on Duplicates</a><a class="headerlink" href="#note-on-duplicates" title="Permalink to this headline">¶</a></h2>
<p>By using the <cite>op_type</cite> = <cite>create</cite> on each bulk line we send to the database and as we use an unique ID(ath id(2.9.X)) the plugin will not index any operation twice. If the node is on a replay, the plugin will start adding to database when it find a new record and never before.</p>
</div>
<div class="section" id="wrapper">
<h2><a class="toc-backref" href="#id23">Wrapper</a><a class="headerlink" href="#wrapper" title="Permalink to this headline">¶</a></h2>
<p>It is not recommended to expose the elasticsearch api fully to the internet. Instead, applications will connect to a wrapper for data:</p>
<p><a class="reference external" href="https://github.com/oxarbitrage/bitshares-es-wrapper">https://github.com/oxarbitrage/bitshares-es-wrapper</a></p>
<p>Elasticsearch database will listen in localhost and the wrapper in the same machine will expose the reduced set of API calls to the internet.</p>
<hr class="docutils" />
<p>#### Contributor:
- &#64;oxarbitrage</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright BitShares Blockchain Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>